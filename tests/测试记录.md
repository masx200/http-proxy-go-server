

###

# DoH HTTP代理服务器测试

执行命令: `go build -o main.exe ../cmd/main.go`

编译代理服务器...
✅ 代理服务器编译成功

启动代理服务器（DoH模式）...
执行命令: `./main.exe -dohurl https://dns.alidns.com/dns-query -dohip 223.5.5.5 -dohip 223.6.6.6 -dohalpn h2 -dohalpn h3`

✅ 代理服务器启动成功

开始测试代理功能...

✅ 8080端口被占用，代理服务器运行正常
测试1: 通过代理访问HTTP网站 (baidu.com)
✅ 测试1成功

测试2: 通过代理访问HTTP网站 (so.com，跟随重定向)
✅ 测试2成功

测试3: 通过代理访问HTTPS网站 (baidu.com)
✅ 测试3成功



###

# DoH HTTP代理服务器测试

执行命令: `go build -o main.exe ../cmd/main.go`

编译代理服务器...
✅ 代理服务器编译成功

启动代理服务器（DoH模式）...
执行命令: `./main.exe -dohurl https://dns.alidns.com/dns-query -dohip 223.5.5.5 -dohip 223.6.6.6 -dohalpn h2 -dohalpn h3`

✅ 代理服务器启动成功

开始测试代理功能...

✅ 8080端口被占用，代理服务器运行正常
测试1: 通过代理访问HTTP网站 (baidu.com)
✅ 测试1成功

测试2: 通过代理访问HTTP网站 (so.com，跟随重定向)
✅ 测试2成功

测试3: 通过代理访问HTTPS网站 (baidu.com)
✅ 测试3成功

### 代理服务器日志输出

```
2025/09/14 13:24:54 main.go:518: 代理服务器启动中...
2025/09/14 13:24:54 main.go:562: dohalpn: [h2, h3]
2025/09/14 13:24:54 main.go:564: hostname: 0.0.0.0
2025/09/14 13:24:54 main.go:566: port: 8080
2025/09/14 13:24:54 main.go:568: server_cert: 
2025/09/14 13:24:54 main.go:570: server_key: 
2025/09/14 13:24:54 main.go:572: username: 
2025/09/14 13:24:54 main.go:574: password: 
2025/09/14 13:24:54 main.go:576: dohurl: [https://dns.alidns.com/dns-query, https://dns.alidns.com/dns-query]
2025/09/14 13:24:54 main.go:578: dohip: [223.5.5.5, 223.6.6.6]
2025/09/14 13:24:54 main.go:579: upstream-type: 
2025/09/14 13:24:54 main.go:580: upstream-address: 
2025/09/14 13:24:54 main.go:581: upstream-username: 
2025/09/14 13:24:54 main.go:582: upstream-password: 
2025/09/14 13:24:54 main.go:927: null
2025/09/14 13:24:54 simple.go:31: Proxy server started on port [::]:8080
2025/09/14 13:24:54 http.go:372: Random IP: 127.82.79.31
2025/09/14 13:24:54 http.go:390: Random integer: 26290
2025/09/14 13:24:54 http.go:342: Proxy server started on port 127.82.79.31:26290
2025/09/14 13:24:56 simple.go:57: remote addr: [::1]:1035
2025/09/14 13:24:56 simple.go:79: GET http://www.baidu.com/ HTTP/1.1
2025/09/14 13:24:56 simple.go:305: Domain: www.baidu.com, Port: 80
2025/09/14 13:24:56 simple.go:117: address:www.baidu.com:80
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.82.79.31:26290
2025/09/14 13:24:56 simple.go:234: 连接成功：127.82.79.31:26290
2025/09/14 13:24:56 simple.go:248: clienthost: ::1
2025/09/14 13:24:56 simple.go:249: clientport: 1035
2025/09/14 13:24:56 simple.go:278: simple Handle header:
2025/09/14 13:24:56 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:24:56 simple.go:283: GET / HTTP/1.1
2025/09/14 13:24:56 simple.go:288: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:24:56 simple.go:294: Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
2025/09/14 13:24:56 http.go:90: method: GET
2025/09/14 13:24:56 http.go:91: url: /
2025/09/14 13:24:56 http.go:92: host: www.baidu.com
2025/09/14 13:24:56 http.go:93: proxyHandler header:
2025/09/14 13:24:56 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:24:56 http.go:121: clientport: 1036
2025/09/14 13:24:56 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.82.79.31:26290;host=www.baidu.com;proto=http
2025/09/14 13:24:56 http.go:132: proxyHandler User-Agent : Go-http-client/1.1
2025/09/14 13:24:56 http.go:132: proxyHandler Accept-Encoding : gzip
2025/09/14 13:24:56 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.82.79.31:26290;host=www.baidu.com;proto=http
2025/09/14 13:24:56 http.go:137: forwardedByList: [{[::1]:8080} {127.82.79.31:26290}]
2025/09/14 13:24:56 http.go:155: targetUrl: http://www.baidu.com/
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
2025/09/14 13:24:56 options.go:186: hostname www.baidu.com no ip found
2025/09/14 13:24:56 doh.go:16: domain: www.baidu.com dnstype: A,AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh.go:28: domain: www.baidu.com dnstype: AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh.go:28: domain: www.baidu.com dnstype: A dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:56 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:56 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:56 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:56 doh.go:91: dns resolved www.baidu.com ips:[240e:e9:6002:1fd:0:ff:b0e1:fe69,240e:e9:6002:1ac:0:ff:b07e:36c5,180.101.51.73,180.101.49.44]
2025/09/14 13:24:56 options.go:240: success connect to address=www.baidu.com:80 by network=tcp by Dohurl=https://dns.alidns.com/dns-query by dohip=223.5.5.5 by serverIP=240e:e9:6002:1ac:0:ff:b07e:36c5
[GIN] 2025/09/14 - 13:24:56 | 200 |    124.5261ms |       127.0.0.1 | GET      "/"
2025/09/14 13:24:56 simple.go:57: remote addr: [::1]:1045
2025/09/14 13:24:56 simple.go:79: HEAD http://www.baidu.com/ HTTP/1.1
2025/09/14 13:24:56 simple.go:305: Domain: www.baidu.com, Port: 80
2025/09/14 13:24:56 simple.go:117: address:www.baidu.com:80
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.82.79.31:26290
2025/09/14 13:24:56 simple.go:234: 连接成功：127.82.79.31:26290
2025/09/14 13:24:56 simple.go:248: clienthost: ::1
2025/09/14 13:24:56 simple.go:249: clientport: 1045
2025/09/14 13:24:56 simple.go:278: simple Handle header:
2025/09/14 13:24:56 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:24:56 simple.go:283: HEAD / HTTP/1.1
2025/09/14 13:24:56 simple.go:288: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:24:56 simple.go:294: Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/14 13:24:56 http.go:90: method: HEAD
2025/09/14 13:24:56 http.go:91: url: /
2025/09/14 13:24:56 http.go:92: host: www.baidu.com
2025/09/14 13:24:56 http.go:93: proxyHandler header:
2025/09/14 13:24:56 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:24:56 http.go:121: clientport: 1046
2025/09/14 13:24:56 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.82.79.31:26290;host=www.baidu.com;proto=http
2025/09/14 13:24:56 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/14 13:24:56 http.go:132: proxyHandler Accept : */*
2025/09/14 13:24:56 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/14 13:24:56 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.82.79.31:26290;host=www.baidu.com;proto=http
2025/09/14 13:24:56 http.go:137: forwardedByList: [{[::1]:8080} {127.82.79.31:26290}]
2025/09/14 13:24:56 http.go:155: targetUrl: http://www.baidu.com/
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
2025/09/14 13:24:56 options.go:186: hostname www.baidu.com no ip found
2025/09/14 13:24:56 doh.go:16: domain: www.baidu.com dnstype: A,AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh.go:28: domain: www.baidu.com dnstype: AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh.go:28: domain: www.baidu.com dnstype: A dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:56 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:56 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:56 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:56 doh.go:91: dns resolved www.baidu.com ips:[180.101.49.44,180.101.51.73,240e:e9:6002:1fd:0:ff:b0e1:fe69,240e:e9:6002:1ac:0:ff:b07e:36c5]
2025/09/14 13:24:56 options.go:240: success connect to address=www.baidu.com:80 by network=tcp by Dohurl=https://dns.alidns.com/dns-query by dohip=223.5.5.5 by serverIP=240e:e9:6002:1fd:0:ff:b0e1:fe69
[GIN] 2025/09/14 - 13:24:56 | 200 |    102.3598ms |       127.0.0.1 | HEAD     "/"
2025/09/14 13:24:56 simple.go:57: remote addr: [::1]:1050
2025/09/14 13:24:56 simple.go:79: HEAD http://www.so.com/ HTTP/1.1
2025/09/14 13:24:56 simple.go:305: Domain: www.so.com, Port: 80
2025/09/14 13:24:56 simple.go:117: address:www.so.com:80
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.82.79.31:26290
2025/09/14 13:24:56 simple.go:234: 连接成功：127.82.79.31:26290
2025/09/14 13:24:56 simple.go:248: clienthost: ::1
2025/09/14 13:24:56 simple.go:249: clientport: 1050
2025/09/14 13:24:56 simple.go:278: simple Handle header:
2025/09/14 13:24:56 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/14 13:24:56 simple.go:283: HEAD / HTTP/1.1
2025/09/14 13:24:56 simple.go:288: Forwarded: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/14 13:24:56 simple.go:294: Host: www.so.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/14 13:24:56 http.go:90: method: HEAD
2025/09/14 13:24:56 http.go:91: url: /
2025/09/14 13:24:56 http.go:92: host: www.so.com
2025/09/14 13:24:56 http.go:93: proxyHandler header:
2025/09/14 13:24:56 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:24:56 http.go:121: clientport: 1051
2025/09/14 13:24:56 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http,for=127.0.0.1;by=127.82.79.31:26290;host=www.so.com;proto=http
2025/09/14 13:24:56 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/14 13:24:56 http.go:132: proxyHandler Accept : */*
2025/09/14 13:24:56 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/14 13:24:56 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http, for=127.0.0.1;by=127.82.79.31:26290;host=www.so.com;proto=http
2025/09/14 13:24:56 http.go:137: forwardedByList: [{[::1]:8080} {127.82.79.31:26290}]
2025/09/14 13:24:56 http.go:155: targetUrl: http://www.so.com/
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.so.com
2025/09/14 13:24:56 options.go:186: hostname www.so.com no ip found
2025/09/14 13:24:56 doh3.go:15: domain: www.so.com dnstype: A,AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh3.go:27: domain: www.so.com dnstype: AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh3.go:27: domain: www.so.com dnstype: A dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 h3.go:60: http3连接成功 dns.alidns.com 443 [::]:56390 223.6.6.6:443
2025/09/14 13:24:56 h3.go:60: http3连接成功 dns.alidns.com 443 [::]:56391 223.6.6.6:443
2025/09/14 13:24:56 doh3.go:80: dns resolved www.so.com ips:[180.163.237.15]
2025/09/14 13:24:56 options.go:240: success connect to address=www.so.com:80 by network=tcp by Dohurl=https://dns.alidns.com/dns-query by dohip=223.6.6.6 by serverIP=180.163.237.15
[GIN] 2025/09/14 - 13:24:56 | 302 |     121.285ms |       127.0.0.1 | HEAD     "/"
2025/09/14 13:24:56 simple.go:57: remote addr: [::1]:1060
2025/09/14 13:24:56 simple.go:79: CONNECT www.so.com:443 HTTP/1.1
2025/09/14 13:24:56 simple.go:117: address:www.so.com:443
2025/09/14 13:24:56 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.so.com:443
2025/09/14 13:24:56 options.go:98: hostname www.so.com no ip found
2025/09/14 13:24:56 options.go:186: hostname www.so.com no ip found
2025/09/14 13:24:56 doh.go:16: domain: www.so.com dnstype: A,AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh.go:28: domain: www.so.com dnstype: AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 doh.go:28: domain: www.so.com dnstype: A dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:56 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:56 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:56 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:56 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:56 doh.go:91: dns resolved www.so.com ips:[180.163.237.15]
2025/09/14 13:24:56 options.go:240: success connect to address=www.so.com:443 by network=tcp by Dohurl=https://dns.alidns.com/dns-query by dohip=223.5.5.5 by serverIP=180.163.237.15
2025/09/14 13:24:56 simple.go:234: 连接成功：www.so.com:443
2025/09/14 13:24:57 simple.go:57: remote addr: [::1]:1065
2025/09/14 13:24:57 simple.go:79: CONNECT www.baidu.com:443 HTTP/1.1
2025/09/14 13:24:57 simple.go:117: address:www.baidu.com:443
2025/09/14 13:24:57 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/14 13:24:57 options.go:98: hostname www.baidu.com no ip found
2025/09/14 13:24:57 options.go:186: hostname www.baidu.com no ip found
2025/09/14 13:24:57 doh.go:16: domain: www.baidu.com dnstype: A,AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:57 doh.go:28: domain: www.baidu.com dnstype: AAAA dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:57 doh.go:28: domain: www.baidu.com dnstype: A dohurl: https://dns.alidns.com/dns-query
2025/09/14 13:24:57 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:57 dns.go:239: 开始发起doh请求 https://dns.alidns.com/dns-query
2025/09/14 13:24:57 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:57 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:57 dns.go:134: DialTLSContext dialing tcp to dns.alidns.com:443
2025/09/14 13:24:57 dns.go:164: DialTLSContext dialing tcp to 223.5.5.5:443
2025/09/14 13:24:57 doh.go:91: dns resolved www.baidu.com ips:[180.101.51.73,180.101.49.44,240e:e9:6002:1ac:0:ff:b07e:36c5,240e:e9:6002:1fd:0:ff:b0e1:fe69]
2025/09/14 13:24:57 options.go:240: success connect to address=www.baidu.com:443 by network=tcp by Dohurl=https://dns.alidns.com/dns-query by dohip=223.5.5.5 by serverIP=180.101.49.44
2025/09/14 13:24:57 simple.go:234: 连接成功：www.baidu.com:443
```



###

# HTTP代理服务器测试记录

## 测试时间
2025-09-14 13:24:59

## 1. 启动代理服务器

执行命令: `go run -v ../cmd/main.go`

编译代理服务器...
✅ 代理服务器编译成功

📋 代理服务器进程PID: 3544

等待服务器启动...
✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 20780

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:46 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_9133499464837253406
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:46 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_9133499464837253406


```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080 -L`

📋 Curl测试2进程PID: 18704

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:46 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
* Ignoring the response-body
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
* Clear auth, redirects to port from 80 to 443
* Issue another request to this URL: 'https://www.so.com/'
* Hostname localhost was found in DNS cache
*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.so.com:443
> CONNECT www.so.com:443 HTTP/1.1
> Host: www.so.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [305 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [93 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [5077 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server did not agree on a protocol. Uses default.
* Server certificate:
*  subject: CN=*.so.com
*  start date: Aug 28 00:00:00 2025 GMT
*  expire date: Sep 28 23:59:59 2026 GMT
*  subjectAltName: host "www.so.com" matched cert's "*.so.com"
*  issuer: C=CN; O=WoTrus CA Limited; CN=WoTrus DV Server CA  [Run by the Issuer]
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha384WithRSAEncryption
*   Certificate level 2: Public key type ? (4096/128 Bits/secBits), signed using sha384WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Server: openresty
< Date: Sun, 14 Sep 2025 05:24:47 GMT
< Content-Type: text/html; charset=UTF-8
< Connection: keep-alive
< Vary: Accept-Encoding
< Set-Cookie: _S=4jjdqidiilcs6e2de61mebpbv4; expires=Sun, 14-Sep-2025 05:34:47 GMT; Max-Age=600; path=/
< Expires: Thu, 19 Nov 1981 08:52:00 GMT
< Cache-Control: no-store, no-cache, must-revalidate
< Pragma: no-cache
< php-waf-rep: -
< Set-Cookie: QiHooGUID=6983C6F9C8F2BA0B3EA2F17631A67A26.1757827487086; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #1 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:46 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/

HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Server: openresty
Date: Sun, 14 Sep 2025 05:24:47 GMT
Content-Type: text/html; charset=UTF-8
Connection: keep-alive
Vary: Accept-Encoding
Set-Cookie: _S=4jjdqidiilcs6e2de61mebpbv4; expires=Sun, 14-Sep-2025 05:34:47 GMT; Max-Age=600; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
php-waf-rep: -
Set-Cookie: QiHooGUID=6983C6F9C8F2BA0B3EA2F17631A67A26.1757827487086; Max-Age=63072000; Domain=so.com; Path=/


```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 9336

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:50 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11544585778122171137
< 
  0   277    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0  0   277    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:50 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11544585778122171137


```

### 📋 所有进程PID记录

所有进程PID: 3544, 20780, 18704, 9336



###

# HTTP代理服务器测试记录

## 测试时间
2025-09-14 13:24:59

## 1. 启动代理服务器

执行命令: `go run -v ../cmd/main.go`

编译代理服务器...
✅ 代理服务器编译成功

📋 代理服务器进程PID: 3544

等待服务器启动...
✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 20780

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:46 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_9133499464837253406
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:46 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_9133499464837253406


```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080 -L`

📋 Curl测试2进程PID: 18704

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:46 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
* Ignoring the response-body
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
* Clear auth, redirects to port from 80 to 443
* Issue another request to this URL: 'https://www.so.com/'
* Hostname localhost was found in DNS cache
*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.so.com:443
> CONNECT www.so.com:443 HTTP/1.1
> Host: www.so.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [305 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [93 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [5077 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server did not agree on a protocol. Uses default.
* Server certificate:
*  subject: CN=*.so.com
*  start date: Aug 28 00:00:00 2025 GMT
*  expire date: Sep 28 23:59:59 2026 GMT
*  subjectAltName: host "www.so.com" matched cert's "*.so.com"
*  issuer: C=CN; O=WoTrus CA Limited; CN=WoTrus DV Server CA  [Run by the Issuer]
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha384WithRSAEncryption
*   Certificate level 2: Public key type ? (4096/128 Bits/secBits), signed using sha384WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Server: openresty
< Date: Sun, 14 Sep 2025 05:24:47 GMT
< Content-Type: text/html; charset=UTF-8
< Connection: keep-alive
< Vary: Accept-Encoding
< Set-Cookie: _S=4jjdqidiilcs6e2de61mebpbv4; expires=Sun, 14-Sep-2025 05:34:47 GMT; Max-Age=600; path=/
< Expires: Thu, 19 Nov 1981 08:52:00 GMT
< Cache-Control: no-store, no-cache, must-revalidate
< Pragma: no-cache
< php-waf-rep: -
< Set-Cookie: QiHooGUID=6983C6F9C8F2BA0B3EA2F17631A67A26.1757827487086; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #1 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:46 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/

HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Server: openresty
Date: Sun, 14 Sep 2025 05:24:47 GMT
Content-Type: text/html; charset=UTF-8
Connection: keep-alive
Vary: Accept-Encoding
Set-Cookie: _S=4jjdqidiilcs6e2de61mebpbv4; expires=Sun, 14-Sep-2025 05:34:47 GMT; Max-Age=600; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
php-waf-rep: -
Set-Cookie: QiHooGUID=6983C6F9C8F2BA0B3EA2F17631A67A26.1757827487086; Max-Age=63072000; Domain=so.com; Path=/


```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 9336

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:50 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11544585778122171137
< 
  0   277    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0  0   277    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:50 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11544585778122171137


```

### 📋 所有进程PID记录

所有进程PID: 3544, 20780, 18704, 9336

## 3. 关闭代理服务器

✅ 所有curl测试成功，正在关闭代理服务器进程...

🛑 正在终止代理服务器进程...
✅ 代理服务器进程已终止

🧹 正在清理所有子进程...

✅ 所有子进程已清理完成

🧹 已清理编译的可执行文件
### 代理服务器日志输出

```
2025/09/14 13:25:00 main.go:518: 代理服务器启动中...
2025/09/14 13:25:00 main.go:562: dohalpn: []
2025/09/14 13:25:00 main.go:564: hostname: 0.0.0.0
2025/09/14 13:25:00 main.go:566: port: 8080
2025/09/14 13:25:00 main.go:568: server_cert: 
2025/09/14 13:25:00 main.go:570: server_key: 
2025/09/14 13:25:00 main.go:572: username: 
2025/09/14 13:25:00 main.go:574: password: 
2025/09/14 13:25:00 main.go:576: dohurl: []
2025/09/14 13:25:00 main.go:578: dohip: []
2025/09/14 13:25:00 main.go:579: upstream-type: 
2025/09/14 13:25:00 main.go:580: upstream-address: 
2025/09/14 13:25:00 main.go:581: upstream-username: 
2025/09/14 13:25:00 main.go:582: upstream-password: 
2025/09/14 13:25:00 main.go:927: null
2025/09/14 13:25:00 simple.go:31: Proxy server started on port [::]:8080
2025/09/14 13:25:00 http.go:372: Random IP: 127.255.208.192
2025/09/14 13:25:00 http.go:390: Random integer: 55999
2025/09/14 13:25:00 http.go:342: Proxy server started on port 127.255.208.192:55999
2025/09/14 13:25:01 simple.go:57: remote addr: [::1]:1099
2025/09/14 13:25:01 simple.go:79: GET http://www.baidu.com/ HTTP/1.1
2025/09/14 13:25:01 simple.go:305: Domain: www.baidu.com, Port: 80
2025/09/14 13:25:01 simple.go:117: address:www.baidu.com:80
2025/09/14 13:25:01 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.255.208.192:55999
2025/09/14 13:25:01 simple.go:234: 连接成功：127.255.208.192:55999
2025/09/14 13:25:01 simple.go:248: clienthost: ::1
2025/09/14 13:25:01 simple.go:249: clientport: 1099
2025/09/14 13:25:01 simple.go:278: simple Handle header:
2025/09/14 13:25:01 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:25:01 simple.go:283: GET / HTTP/1.1
2025/09/14 13:25:01 simple.go:288: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:25:01 simple.go:294: Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
2025/09/14 13:25:01 http.go:90: method: GET
2025/09/14 13:25:01 http.go:91: url: /
2025/09/14 13:25:01 http.go:92: host: www.baidu.com
2025/09/14 13:25:01 http.go:93: proxyHandler header:
2025/09/14 13:25:01 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:25:01 http.go:121: clientport: 1100
2025/09/14 13:25:01 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.255.208.192:55999;host=www.baidu.com;proto=http
2025/09/14 13:25:01 http.go:132: proxyHandler User-Agent : Go-http-client/1.1
2025/09/14 13:25:01 http.go:132: proxyHandler Accept-Encoding : gzip
2025/09/14 13:25:01 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.255.208.192:55999;host=www.baidu.com;proto=http
2025/09/14 13:25:01 http.go:137: forwardedByList: [{[::1]:8080} {127.255.208.192:55999}]
2025/09/14 13:25:01 http.go:155: targetUrl: http://www.baidu.com/
2025/09/14 13:25:01 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/14 - 13:25:01 | 200 |    104.3713ms |       127.0.0.1 | GET      "/"
2025/09/14 13:25:03 simple.go:57: remote addr: [::1]:1123
2025/09/14 13:25:03 simple.go:79: HEAD http://www.baidu.com/ HTTP/1.1
2025/09/14 13:25:03 simple.go:305: Domain: www.baidu.com, Port: 80
2025/09/14 13:25:03 simple.go:117: address:www.baidu.com:80
2025/09/14 13:25:03 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.255.208.192:55999
2025/09/14 13:25:03 simple.go:234: 连接成功：127.255.208.192:55999
2025/09/14 13:25:03 simple.go:248: clienthost: ::1
2025/09/14 13:25:03 simple.go:249: clientport: 1123
2025/09/14 13:25:03 simple.go:278: simple Handle header:
2025/09/14 13:25:03 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:25:03 simple.go:283: HEAD / HTTP/1.1
2025/09/14 13:25:03 simple.go:288: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/14 13:25:03 simple.go:294: Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/14 13:25:03 http.go:90: method: HEAD
2025/09/14 13:25:03 http.go:91: url: /
2025/09/14 13:25:03 http.go:92: host: www.baidu.com
2025/09/14 13:25:03 http.go:93: proxyHandler header:
2025/09/14 13:25:03 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:25:03 http.go:121: clientport: 1124
2025/09/14 13:25:03 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.255.208.192:55999;host=www.baidu.com;proto=http
2025/09/14 13:25:03 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/14 13:25:03 http.go:132: proxyHandler Accept : */*
2025/09/14 13:25:03 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/14 13:25:03 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.255.208.192:55999;host=www.baidu.com;proto=http
2025/09/14 13:25:03 http.go:137: forwardedByList: [{[::1]:8080} {127.255.208.192:55999}]
2025/09/14 13:25:03 http.go:155: targetUrl: http://www.baidu.com/
2025/09/14 13:25:03 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/14 - 13:25:03 | 200 |     34.8899ms |       127.0.0.1 | HEAD     "/"
2025/09/14 13:25:03 simple.go:57: remote addr: [::1]:1125
2025/09/14 13:25:03 simple.go:79: HEAD http://www.so.com/ HTTP/1.1
2025/09/14 13:25:03 simple.go:305: Domain: www.so.com, Port: 80
2025/09/14 13:25:03 simple.go:117: address:www.so.com:80
2025/09/14 13:25:03 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.255.208.192:55999
2025/09/14 13:25:03 simple.go:234: 连接成功：127.255.208.192:55999
2025/09/14 13:25:03 simple.go:248: clienthost: ::1
2025/09/14 13:25:03 simple.go:249: clientport: 1125
2025/09/14 13:25:03 simple.go:278: simple Handle header:
2025/09/14 13:25:03 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/14 13:25:03 simple.go:283: HEAD / HTTP/1.1
2025/09/14 13:25:03 simple.go:288: Forwarded: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/14 13:25:03 simple.go:294: Host: www.so.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/14 13:25:03 http.go:90: method: HEAD
2025/09/14 13:25:03 http.go:91: url: /
2025/09/14 13:25:03 http.go:92: host: www.so.com
2025/09/14 13:25:03 http.go:93: proxyHandler header:
2025/09/14 13:25:03 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:25:03 http.go:121: clientport: 1126
2025/09/14 13:25:03 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http,for=127.0.0.1;by=127.255.208.192:55999;host=www.so.com;proto=http
2025/09/14 13:25:03 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/14 13:25:03 http.go:132: proxyHandler Accept : */*
2025/09/14 13:25:03 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/14 13:25:03 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http, for=127.0.0.1;by=127.255.208.192:55999;host=www.so.com;proto=http
2025/09/14 13:25:03 http.go:137: forwardedByList: [{[::1]:8080} {127.255.208.192:55999}]
2025/09/14 13:25:03 http.go:155: targetUrl: http://www.so.com/
2025/09/14 13:25:03 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.so.com
[GIN] 2025/09/14 - 13:25:04 | 302 |     71.5698ms |       127.0.0.1 | HEAD     "/"
2025/09/14 13:25:04 simple.go:57: remote addr: [::1]:1137
2025/09/14 13:25:04 simple.go:79: CONNECT www.so.com:443 HTTP/1.1
2025/09/14 13:25:04 simple.go:117: address:www.so.com:443
2025/09/14 13:25:04 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.so.com:443
2025/09/14 13:25:04 options.go:98: hostname www.so.com no ip found
2025/09/14 13:25:04 options.go:123: success connect to www.so.com:443 by tcp
2025/09/14 13:25:04 simple.go:234: 连接成功：www.so.com:443
2025/09/14 13:25:04 simple.go:57: remote addr: [::1]:1142
2025/09/14 13:25:04 simple.go:79: CONNECT www.baidu.com:443 HTTP/1.1
2025/09/14 13:25:04 simple.go:117: address:www.baidu.com:443
2025/09/14 13:25:04 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/14 13:25:04 options.go:98: hostname www.baidu.com no ip found
2025/09/14 13:25:04 options.go:123: success connect to www.baidu.com:443 by tcp
2025/09/14 13:25:04 simple.go:234: 连接成功：www.baidu.com:443
```

### 所有子进程日志输出

```
### Curl测试1输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:46 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_9133499464837253406
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:46 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_9133499464837253406
### Curl测试2输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:46 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
* Ignoring the response-body
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
* Clear auth, redirects to port from 80 to 443
* Issue another request to this URL: 'https://www.so.com/'
* Hostname localhost was found in DNS cache
*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.so.com:443
> CONNECT www.so.com:443 HTTP/1.1
> Host: www.so.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [305 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [93 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [5077 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server did not agree on a protocol. Uses default.
* Server certificate:
*  subject: CN=*.so.com
*  start date: Aug 28 00:00:00 2025 GMT
*  expire date: Sep 28 23:59:59 2026 GMT
*  subjectAltName: host "www.so.com" matched cert's "*.so.com"
*  issuer: C=CN; O=WoTrus CA Limited; CN=WoTrus DV Server CA  [Run by the Issuer]
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha384WithRSAEncryption
*   Certificate level 2: Public key type ? (4096/128 Bits/secBits), signed using sha384WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Server: openresty
< Date: Sun, 14 Sep 2025 05:24:47 GMT
< Content-Type: text/html; charset=UTF-8
< Connection: keep-alive
< Vary: Accept-Encoding
< Set-Cookie: _S=4jjdqidiilcs6e2de61mebpbv4; expires=Sun, 14-Sep-2025 05:34:47 GMT; Max-Age=600; path=/
< Expires: Thu, 19 Nov 1981 08:52:00 GMT
< Cache-Control: no-store, no-cache, must-revalidate
< Pragma: no-cache
< php-waf-rep: -
< Set-Cookie: QiHooGUID=6983C6F9C8F2BA0B3EA2F17631A67A26.1757827487086; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #1 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:46 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
HTTP/1.1 200 Connection established
HTTP/1.1 200 OK
Server: openresty
Date: Sun, 14 Sep 2025 05:24:47 GMT
Content-Type: text/html; charset=UTF-8
Connection: keep-alive
Vary: Accept-Encoding
Set-Cookie: _S=4jjdqidiilcs6e2de61mebpbv4; expires=Sun, 14-Sep-2025 05:34:47 GMT; Max-Age=600; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
php-waf-rep: -
Set-Cookie: QiHooGUID=6983C6F9C8F2BA0B3EA2F17631A67A26.1757827487086; Max-Age=63072000; Domain=so.com; Path=/
### Curl测试3输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:24:50 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11544585778122171137
< 
  0   277    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0  0   277    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:24:50 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11544585778122171137
```

✅ 端口8080已成功释放


###

# WebSocket和http级联代理测试记录

## 测试时间
2025-09-14 13:25:12

## 1. 编译代理服务器

执行命令: `go build -o socks5-websocket-proxy-golang.exe github.com/masx200/socks5-websocket-proxy-golang/cmd`

✅ 代理服务器编译成功

## 2. 启动WebSocket服务器（上游）

执行命令: `./socks5-websocket-proxy-golang.exe -mode server -protocol websocket -addr :38800`

📋 WebSocket服务器进程PID: 30124

等待WebSocket服务器启动...
✅ WebSocket服务器启动成功

## 3. 启动http服务器（下游）

执行命令: `./main.exe  -port 10810 -upstream-type websocket -upstream-address ws://localhost:38800`

📋 http服务器进程PID: 32824

等待http服务器启动...
✅ http服务器启动成功

## 4. 测试级联代理功能

### 测试1: HTTP代理通过级联

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:10810`

📋 Curl测试1进程PID: 3664, 退出状态码: 0

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:10810 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:10810...
* Connected to localhost (::1) port 10810
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:25:01 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11482248781691734417
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:25:01 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11482248781691734417


```

### 测试2: HTTPS代理通过级联

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:10810`

📋 Curl测试2进程PID: 7136, 退出状态码: 0

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:10810 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:10810...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 10810
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:25:01 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11556655701353736369
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:25:01 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11556655701353736369


```

### 📋 所有进程PID记录

所有进程PID: 30124, 32824, 3664, 7136



###

# WebSocket和http级联代理测试记录

## 测试时间
2025-09-14 13:25:12

## 1. 编译代理服务器

执行命令: `go build -o socks5-websocket-proxy-golang.exe github.com/masx200/socks5-websocket-proxy-golang/cmd`

✅ 代理服务器编译成功

## 2. 启动WebSocket服务器（上游）

执行命令: `./socks5-websocket-proxy-golang.exe -mode server -protocol websocket -addr :38800`

📋 WebSocket服务器进程PID: 30124

等待WebSocket服务器启动...
✅ WebSocket服务器启动成功

## 3. 启动http服务器（下游）

执行命令: `./main.exe  -port 10810 -upstream-type websocket -upstream-address ws://localhost:38800`

📋 http服务器进程PID: 32824

等待http服务器启动...
✅ http服务器启动成功

## 4. 测试级联代理功能

### 测试1: HTTP代理通过级联

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:10810`

📋 Curl测试1进程PID: 3664, 退出状态码: 0

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:10810 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:10810...
* Connected to localhost (::1) port 10810
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:25:01 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11482248781691734417
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:25:01 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11482248781691734417


```

### 测试2: HTTPS代理通过级联

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:10810`

📋 Curl测试2进程PID: 7136, 退出状态码: 0

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:10810 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:10810...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 10810
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Sun, 14 Sep 2025 05:25:01 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11556655701353736369
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Sun, 14 Sep 2025 05:25:01 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11556655701353736369


```

### 📋 所有进程PID记录

所有进程PID: 30124, 32824, 3664, 7136

## 5. 关闭服务器

✅ 所有测试成功，正在关闭服务器进程...

🛑 正在终止WebSocket服务器进程...
✅ WebSocket服务器进程已终止

🛑 正在终止http服务器进程...
✅ http服务器进程已终止

🧹 正在清理所有子进程...
✅ 所有子进程已清理完成

🧹 已清理编译的可执行文件
### WebSocket服务器日志输出

```
2025/09/14 13:25:14 main.go:71: 启动websocket服务端，监听地址: :38800
2025/09/14 13:25:14 server.go:71: [WEBSOCKET-SERVER] Server started successfully, listening on :38800
2025/09/14 13:25:14 server.go:72: [WEBSOCKET-SERVER] Authentication enabled: false (0 users configured)
2025/09/14 13:25:14 server.go:74: [WEBSOCKET-SERVER] Upstream selector enabled: false
2025/09/14 13:25:14 server.go:75: [WEBSOCKET-SERVER] Read timeout: 30s, Write timeout: 30s
2025/09/14 13:25:14 main.go:129: websocket服务端已启动，按Ctrl+C停止
2025/09/14 13:25:16 server.go:90: url /
2025/09/14 13:25:16 server.go:92: headers map[Connection:[Upgrade] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Sec-Websocket-Key:[feQom3EmEROVg52ZA61ibA==] Sec-Websocket-Version:[13] Upgrade:[websocket] User-Agent:[Go-http-client/1.1] X-Proxy-Target-Host:[127.51.133.255] X-Proxy-Target-Port:[16547]]
2025/09/14 13:25:16 server.go:95: [WEBSOCKET-CONN] New connection attempt from [::1]:1310 at 2025-09-14 13:25:16
2025/09/14 13:25:16 server.go:101: [WEBSOCKET-CONN] No authentication required for client [::1]:1310
2025/09/14 13:25:16 server.go:306: [WEBSOCKET-AUTH] Parsed auth info - username: '', password: '', targetHost: '127.51.133.255', targetPort: 16547
2025/09/14 13:25:16 server.go:173: [WEBSOCKET-AUTH] No authentication configured, allowing access for user ''
2025/09/14 13:25:16 server.go:119: [WEBSOCKET-AUTH] Authentication successful for user '' from [::1]:1310
2025/09/14 13:25:16 server.go:129: [WEBSOCKET-CONN] WebSocket connection established successfully for target 127.51.133.255:16547 from [::1]:1310
2025/09/14 13:25:16 server.go:227: [WEBSOCKET-UPSTREAM] Using direct connection for target 127.51.133.255:16547 (timeout: 30s)
2025/09/14 13:25:16 server.go:232: [WEBSOCKET-UPSTREAM] Direct connection established for target 127.51.133.255:16547
2025/09/14 13:25:16 server.go:316: [WEBSOCKET-FORWARD] Starting data forwarding between connections
2025/09/14 13:25:16 server.go:90: url /
2025/09/14 13:25:16 server.go:92: headers map[Connection:[Upgrade] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Sec-Websocket-Key:[bg95jY06eu0HGXaOtkSx/A==] Sec-Websocket-Version:[13] Upgrade:[websocket] User-Agent:[Go-http-client/1.1] X-Proxy-Target-Host:[www.baidu.com] X-Proxy-Target-Port:[80]]
2025/09/14 13:25:16 server.go:95: [WEBSOCKET-CONN] New connection attempt from [::1]:1312 at 2025-09-14 13:25:16
2025/09/14 13:25:16 server.go:101: [WEBSOCKET-CONN] No authentication required for client [::1]:1312
2025/09/14 13:25:16 server.go:306: [WEBSOCKET-AUTH] Parsed auth info - username: '', password: '', targetHost: 'www.baidu.com', targetPort: 80
2025/09/14 13:25:16 server.go:173: [WEBSOCKET-AUTH] No authentication configured, allowing access for user ''
2025/09/14 13:25:16 server.go:119: [WEBSOCKET-AUTH] Authentication successful for user '' from [::1]:1312
2025/09/14 13:25:16 server.go:129: [WEBSOCKET-CONN] WebSocket connection established successfully for target www.baidu.com:80 from [::1]:1312
2025/09/14 13:25:16 server.go:227: [WEBSOCKET-UPSTREAM] Using direct connection for target www.baidu.com:80 (timeout: 30s)
2025/09/14 13:25:16 server.go:232: [WEBSOCKET-UPSTREAM] Direct connection established for target www.baidu.com:80
2025/09/14 13:25:16 server.go:316: [WEBSOCKET-FORWARD] Starting data forwarding between connections
2025/09/14 13:25:18 server.go:90: url /
2025/09/14 13:25:18 server.go:92: headers map[Connection:[Upgrade] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Sec-Websocket-Key:[38WLSOFXDn6rw1zZD9i56w==] Sec-Websocket-Version:[13] Upgrade:[websocket] User-Agent:[Go-http-client/1.1] X-Proxy-Target-Host:[127.51.133.255] X-Proxy-Target-Port:[16547]]
2025/09/14 13:25:18 server.go:95: [WEBSOCKET-CONN] New connection attempt from [::1]:1328 at 2025-09-14 13:25:18
2025/09/14 13:25:18 server.go:101: [WEBSOCKET-CONN] No authentication required for client [::1]:1328
2025/09/14 13:25:18 server.go:306: [WEBSOCKET-AUTH] Parsed auth info - username: '', password: '', targetHost: '127.51.133.255', targetPort: 16547
2025/09/14 13:25:18 server.go:173: [WEBSOCKET-AUTH] No authentication configured, allowing access for user ''
2025/09/14 13:25:18 server.go:119: [WEBSOCKET-AUTH] Authentication successful for user '' from [::1]:1328
2025/09/14 13:25:18 server.go:129: [WEBSOCKET-CONN] WebSocket connection established successfully for target 127.51.133.255:16547 from [::1]:1328
2025/09/14 13:25:18 server.go:227: [WEBSOCKET-UPSTREAM] Using direct connection for target 127.51.133.255:16547 (timeout: 30s)
2025/09/14 13:25:18 server.go:232: [WEBSOCKET-UPSTREAM] Direct connection established for target 127.51.133.255:16547
2025/09/14 13:25:18 server.go:316: [WEBSOCKET-FORWARD] Starting data forwarding between connections
2025/09/14 13:25:18 server.go:90: url /
2025/09/14 13:25:18 server.go:92: headers map[Connection:[Upgrade] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Sec-Websocket-Key:[5oUiCNmdu8GkueW1h4u9ew==] Sec-Websocket-Version:[13] Upgrade:[websocket] User-Agent:[Go-http-client/1.1] X-Proxy-Target-Host:[www.baidu.com] X-Proxy-Target-Port:[443]]
2025/09/14 13:25:18 server.go:95: [WEBSOCKET-CONN] New connection attempt from [::1]:1331 at 2025-09-14 13:25:18
2025/09/14 13:25:18 server.go:101: [WEBSOCKET-CONN] No authentication required for client [::1]:1331
2025/09/14 13:25:18 server.go:306: [WEBSOCKET-AUTH] Parsed auth info - username: '', password: '', targetHost: 'www.baidu.com', targetPort: 443
2025/09/14 13:25:18 server.go:173: [WEBSOCKET-AUTH] No authentication configured, allowing access for user ''
2025/09/14 13:25:18 server.go:119: [WEBSOCKET-AUTH] Authentication successful for user '' from [::1]:1331
2025/09/14 13:25:18 server.go:129: [WEBSOCKET-CONN] WebSocket connection established successfully for target www.baidu.com:443 from [::1]:1331
2025/09/14 13:25:18 server.go:227: [WEBSOCKET-UPSTREAM] Using direct connection for target www.baidu.com:443 (timeout: 30s)
2025/09/14 13:25:18 server.go:232: [WEBSOCKET-UPSTREAM] Direct connection established for target www.baidu.com:443
2025/09/14 13:25:18 server.go:316: [WEBSOCKET-FORWARD] Starting data forwarding between connections
```

### http服务器日志输出

```
2025/09/14 13:25:15 main.go:518: 代理服务器启动中...
2025/09/14 13:25:15 main.go:562: dohalpn: []
2025/09/14 13:25:15 main.go:564: hostname: 0.0.0.0
2025/09/14 13:25:15 main.go:566: port: 10810
2025/09/14 13:25:15 main.go:568: server_cert: 
2025/09/14 13:25:15 main.go:570: server_key: 
2025/09/14 13:25:15 main.go:572: username: 
2025/09/14 13:25:15 main.go:574: password: 
2025/09/14 13:25:15 main.go:576: dohurl: []
2025/09/14 13:25:15 main.go:578: dohip: []
2025/09/14 13:25:15 main.go:579: upstream-type: websocket
2025/09/14 13:25:15 main.go:580: upstream-address: ws://localhost:38800
2025/09/14 13:25:15 main.go:581: upstream-username: 
2025/09/14 13:25:15 main.go:582: upstream-password: 
2025/09/14 13:25:15 main.go:639: WebSocket代理配置已添加
2025/09/14 13:25:15 main.go:927: {
  "hostname": "",
  "port": 0,
  "server_cert": "",
  "server_key": "",
  "username": "",
  "password": "",
  "doh": null,
  "upstreams": {
    "websocket_upstream": {
      "type": "websocket",
      "http_proxy": "ws://localhost:38800",
      "https_proxy": "ws://localhost:38800",
      "bypass_list": null,
      "ws_proxy": "ws://localhost:38800",
      "ws_username": "",
      "ws_password": "",
      "http_username": "",
      "http_password": "",
      "socks5_proxy": "ws://localhost:38800",
      "socks5_username": "",
      "socks5_password": ""
    }
  },
  "rules": [
    {
      "filter": "websocket_filter",
      "upstream": "websocket_upstream"
    }
  ],
  "filters": {
    "websocket_filter": {
      "patterns": [
        "*"
      ]
    }
  }
}
2025/09/14 13:25:15 simple.go:31: Proxy server started on port [::]:10810
2025/09/14 13:25:15 http.go:372: Random IP: 127.51.133.255
2025/09/14 13:25:15 http.go:390: Random integer: 16547
2025/09/14 13:25:15 http.go:342: Proxy server started on port 127.51.133.255:16547
2025/09/14 13:25:16 simple.go:57: remote addr: [::1]:1309
2025/09/14 13:25:16 simple.go:79: GET http://www.baidu.com/ HTTP/1.1
2025/09/14 13:25:16 simple.go:305: Domain: www.baidu.com, Port: 80
2025/09/14 13:25:16 simple.go:117: address:www.baidu.com:80
2025/09/14 13:25:16 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.51.133.255:16547
2025/09/14 13:25:16 main.go:828: ProxySelector 127.51.133.255:16547
2025/09/14 13:25:16 main.go:834: 选择的代理 URL: ws://localhost:38800
2025/09/14 13:25:16 simple.go:179: WebSocket Config Details:
2025/09/14 13:25:16 simple.go:180: host, portNum 127.51.133.255 16547
2025/09/14 13:25:16 simple.go:181:   Username: 
2025/09/14 13:25:16 simple.go:182:   Password: 
2025/09/14 13:25:16 simple.go:183:   ServerAddr: ws://localhost:38800
2025/09/14 13:25:16 simple.go:184:   Protocol: websocket
2025/09/14 13:25:16 simple.go:185:   Timeout: 30s
2025/09/14 13:25:16 client.go:98: url: ws://localhost:38800
2025/09/14 13:25:16 client.go:99: headers: map[X-Proxy-Target-Host:[127.51.133.255] X-Proxy-Target-Port:[16547]]
2025/09/14 13:25:16 client.go:110: url: http://localhost:38800
2025/09/14 13:25:16 client.go:111: headers: map[Connection:[Upgrade] Sec-Websocket-Accept:[04uZRi0ZdWBk96vB85+V3B4oe7Q=] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Upgrade:[websocket]]
2025/09/14 13:25:16 simple.go:209: WebSocket代理连接成功：127.51.133.255:16547
2025/09/14 13:25:16 simple.go:248: clienthost: ::1
2025/09/14 13:25:16 simple.go:249: clientport: 1309
2025/09/14 13:25:16 simple.go:278: simple Handle header:
2025/09/14 13:25:16 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http
2025/09/14 13:25:16 simple.go:283: GET / HTTP/1.1
2025/09/14 13:25:16 simple.go:288: Forwarded: for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http
2025/09/14 13:25:16 simple.go:294: Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
2025/09/14 13:25:16 http.go:90: method: GET
2025/09/14 13:25:16 http.go:91: url: /
2025/09/14 13:25:16 http.go:92: host: www.baidu.com
2025/09/14 13:25:16 http.go:93: proxyHandler header:
2025/09/14 13:25:16 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:25:16 http.go:121: clientport: 1311
2025/09/14 13:25:16 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.51.133.255:16547;host=www.baidu.com;proto=http
2025/09/14 13:25:16 http.go:132: proxyHandler User-Agent : Go-http-client/1.1
2025/09/14 13:25:16 http.go:132: proxyHandler Accept-Encoding : gzip
2025/09/14 13:25:16 http.go:135: forwardedHeader: for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.51.133.255:16547;host=www.baidu.com;proto=http
2025/09/14 13:25:16 http.go:137: forwardedByList: [{[::1]:10810} {127.51.133.255:16547}]
2025/09/14 13:25:16 http.go:155: targetUrl: http://www.baidu.com/
2025/09/14 13:25:16 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
2025/09/14 13:25:16 main.go:828: ProxySelector www.baidu.com
2025/09/14 13:25:16 main.go:834: 选择的代理 URL: ws://localhost:38800
2025/09/14 13:25:16 http.go:250: 使用代理：ws://localhost:38800
2025/09/14 13:25:16 http.go:259: 已经修改了代理为websocket ws://localhost:38800
2025/09/14 13:25:16 http.go:262: 使用代理：ws://localhost:38800
2025/09/14 13:25:16 http.go:264: network,addr tcp www.baidu.com:80
2025/09/14 13:25:16 http.go:466: WebSocket Config Details:
2025/09/14 13:25:16 http.go:467: host, portNum www.baidu.com 80
2025/09/14 13:25:16 http.go:468:   Username: 
2025/09/14 13:25:16 http.go:469:   Password: 
2025/09/14 13:25:16 http.go:470:   ServerAddr: ws://localhost:38800
2025/09/14 13:25:16 http.go:471:   Protocol: websocket
2025/09/14 13:25:16 http.go:472:   Timeout: 30s
2025/09/14 13:25:16 http.go:476: host, portNum www.baidu.com 80
2025/09/14 13:25:16 client.go:98: url: ws://localhost:38800
2025/09/14 13:25:16 client.go:99: headers: map[X-Proxy-Target-Host:[www.baidu.com] X-Proxy-Target-Port:[80]]
2025/09/14 13:25:16 client.go:110: url: http://localhost:38800
2025/09/14 13:25:16 client.go:111: headers: map[Connection:[Upgrade] Sec-Websocket-Accept:[lsjSaF2KwSSrEOXOQkLjs768K6E=] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Upgrade:[websocket]]
[GIN] 2025/09/14 - 13:25:16 | 200 |     84.7021ms |       127.0.0.1 | GET      "/"
2025/09/14 13:25:18 simple.go:57: remote addr: [::1]:1327
2025/09/14 13:25:18 simple.go:79: HEAD http://www.baidu.com/ HTTP/1.1
2025/09/14 13:25:18 simple.go:305: Domain: www.baidu.com, Port: 80
2025/09/14 13:25:18 simple.go:117: address:www.baidu.com:80
2025/09/14 13:25:18 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.51.133.255:16547
2025/09/14 13:25:18 main.go:828: ProxySelector 127.51.133.255:16547
2025/09/14 13:25:18 main.go:834: 选择的代理 URL: ws://localhost:38800
2025/09/14 13:25:18 simple.go:179: WebSocket Config Details:
2025/09/14 13:25:18 simple.go:180: host, portNum 127.51.133.255 16547
2025/09/14 13:25:18 simple.go:181:   Username: 
2025/09/14 13:25:18 simple.go:182:   Password: 
2025/09/14 13:25:18 simple.go:183:   ServerAddr: ws://localhost:38800
2025/09/14 13:25:18 simple.go:184:   Protocol: websocket
2025/09/14 13:25:18 simple.go:185:   Timeout: 30s
2025/09/14 13:25:18 client.go:98: url: ws://localhost:38800
2025/09/14 13:25:18 client.go:99: headers: map[X-Proxy-Target-Host:[127.51.133.255] X-Proxy-Target-Port:[16547]]
2025/09/14 13:25:18 client.go:110: url: http://localhost:38800
2025/09/14 13:25:18 client.go:111: headers: map[Connection:[Upgrade] Sec-Websocket-Accept:[uU0nhUimmSCMjNnR73cf2irV9GM=] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Upgrade:[websocket]]
2025/09/14 13:25:18 simple.go:209: WebSocket代理连接成功：127.51.133.255:16547
2025/09/14 13:25:18 simple.go:248: clienthost: ::1
2025/09/14 13:25:18 simple.go:249: clientport: 1327
2025/09/14 13:25:18 simple.go:278: simple Handle header:
2025/09/14 13:25:18 simple.go:281: simple Handle Forwarded : for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http
2025/09/14 13:25:18 simple.go:283: HEAD / HTTP/1.1
2025/09/14 13:25:18 simple.go:288: Forwarded: for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http
2025/09/14 13:25:18 simple.go:294: Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/14 13:25:18 http.go:90: method: HEAD
2025/09/14 13:25:18 http.go:91: url: /
2025/09/14 13:25:18 http.go:92: host: www.baidu.com
2025/09/14 13:25:18 http.go:93: proxyHandler header:
2025/09/14 13:25:18 http.go:120: clienthost: 127.0.0.1
2025/09/14 13:25:18 http.go:121: clientport: 1329
2025/09/14 13:25:18 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/14 13:25:18 http.go:132: proxyHandler Accept : */*
2025/09/14 13:25:18 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/14 13:25:18 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.51.133.255:16547;host=www.baidu.com;proto=http
2025/09/14 13:25:18 http.go:135: forwardedHeader: for=::1;by=[::1]:10810;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.51.133.255:16547;host=www.baidu.com;proto=http
2025/09/14 13:25:18 http.go:137: forwardedByList: [{[::1]:10810} {127.51.133.255:16547}]
2025/09/14 13:25:18 http.go:155: targetUrl: http://www.baidu.com/
2025/09/14 13:25:18 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
2025/09/14 13:25:18 main.go:828: ProxySelector www.baidu.com
2025/09/14 13:25:18 main.go:834: 选择的代理 URL: ws://localhost:38800
2025/09/14 13:25:18 http.go:250: 使用代理：ws://localhost:38800
2025/09/14 13:25:18 http.go:259: 已经修改了代理为websocket ws://localhost:38800
[GIN] 2025/09/14 - 13:25:18 | 200 |     20.4956ms |       127.0.0.1 | HEAD     "/"
2025/09/14 13:25:18 simple.go:57: remote addr: [::1]:1330
2025/09/14 13:25:18 simple.go:79: CONNECT www.baidu.com:443 HTTP/1.1
2025/09/14 13:25:18 simple.go:117: address:www.baidu.com:443
2025/09/14 13:25:18 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/14 13:25:18 main.go:828: ProxySelector www.baidu.com:443
2025/09/14 13:25:18 main.go:834: 选择的代理 URL: ws://localhost:38800
2025/09/14 13:25:18 simple.go:179: WebSocket Config Details:
2025/09/14 13:25:18 simple.go:180: host, portNum www.baidu.com 443
2025/09/14 13:25:18 simple.go:181:   Username: 
2025/09/14 13:25:18 simple.go:182:   Password: 
2025/09/14 13:25:18 simple.go:183:   ServerAddr: ws://localhost:38800
2025/09/14 13:25:18 simple.go:184:   Protocol: websocket
2025/09/14 13:25:18 simple.go:185:   Timeout: 30s
2025/09/14 13:25:18 client.go:98: url: ws://localhost:38800
2025/09/14 13:25:18 client.go:99: headers: map[X-Proxy-Target-Host:[www.baidu.com] X-Proxy-Target-Port:[443]]
2025/09/14 13:25:18 client.go:110: url: http://localhost:38800
2025/09/14 13:25:18 client.go:111: headers: map[Connection:[Upgrade] Sec-Websocket-Accept:[GOTCNytg8Io2xH5dP3TrUZKOXVM=] Sec-Websocket-Extensions:[permessage-deflate; server_no_context_takeover; client_no_context_takeover] Upgrade:[websocket]]
2025/09/14 13:25:18 simple.go:209: WebSocket代理连接成功：www.baidu.com:443
2025/09/14 13:25:18 http.go:493: WebSocket ForwardData error: read tcp [::1]:1312->[::1]:38800: wsarecv: An existing connection was forcibly closed by the remote host.
2025/09/14 13:25:18 simple.go:204: WebSocket ForwardData error: read tcp [::1]:1310->[::1]:38800: wsarecv: An existing connection was forcibly closed by the remote host.
2025/09/14 13:25:18 simple.go:204: WebSocket ForwardData error: read tcp [::1]:1331->[::1]:38800: wsarecv: An existing connection was forcibly closed by the remote host.
2025/09/14 13:25:18 simple.go:204: WebSocket ForwardData error: read tcp [::1]:1328->[::1]:38800: wsarecv: An existing connection was forcibly closed by the remote host.
```

✅ 端口38800已成功释放
✅ 端口10810已成功释放
