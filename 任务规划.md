# HTTP ä»£ç†æœåŠ¡å™¨ WebSocket æ”¯æŒä»»åŠ¡æ¸…å•

## é¡¹ç›®ç°çŠ¶åˆ†æ

å½“å‰é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Golang çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

- HTTP/HTTPS ä»£ç†
- TLS è®¤è¯
- åŸºæœ¬è®¤è¯
- DOH (DNS over HTTPS)
- å¤šä¸Šæ¸¸ä»£ç†é…ç½®
- è§„åˆ™å’Œè¿‡æ»¤å™¨ç³»ç»Ÿ
- JSON é…ç½®æ–‡ä»¶æ”¯æŒ

## ä»»åŠ¡ç›®æ ‡

ä¸ºé¡¹ç›®æ·»åŠ  WebSocket åè®®ä½œä¸ºä¸Šæ¸¸ä»£ç†çš„æ”¯æŒï¼Œ æ¯ä¸€æ­¥å®Œæˆéƒ½æ›´æ–°ä»»åŠ¡æ¸…å•,åŒ…æ‹¬ï¼š

1. å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ WebSocket ä¸Šæ¸¸ä»£ç†
2. é…ç½®æ–‡ä»¶æ”¯æŒ WebSocket ä¸Šæ¸¸ä»£ç†ç±»å‹
3. é›†æˆ socks5-websocket-proxy-golang å®¢æˆ·ç«¯

## è¯¦ç»†ä»»åŠ¡æ¸…å•

### 1. ç†è§£ç°æœ‰æ¶æ„ âœ…

- [x] åˆ†æ main.go ä¸­çš„ä»£ç†é€‰æ‹©é€»è¾‘
- [x] ç†è§£ ProxySelector å‡½æ•°çš„å·¥ä½œåŸç†
- [x] åˆ†æ transportConfigurations çš„æ„å»ºè¿‡ç¨‹
- [x] ç†è§£ UpStream ç»“æ„ä½“å’Œç›¸å…³é…ç½®

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- ç°æœ‰æ¶æ„ä½¿ç”¨transportConfigurationsæ•°ç»„é…ç½®http.Transport
- ProxySelectorå‡½æ•°è´Ÿè´£æ ¹æ®è§„åˆ™é€‰æ‹©ä»£ç†URL
- UpStreamç»“æ„ä½“åŒ…å«HTTP_PROXYã€HTTPS_PROXYã€BypassListå­—æ®µ
- ä»£ç†é€‰æ‹©é€»è¾‘é€šè¿‡t.Proxyå›è°ƒå‡½æ•°å®ç°
- é…ç½®æ–‡ä»¶æ”¯æŒJSONæ ¼å¼ï¼ŒåŒ…å«UpStreamsã€Rulesã€Filtersç­‰ç»“æ„

### 2. è®¾è®¡ WebSocket ä»£ç†æ”¯æŒ âœ…

- [x] å®šä¹‰ WebSocket ä¸Šæ¸¸ä»£ç†çš„é…ç½®ç»“æ„
- [x] è®¾è®¡ WebSocket ä»£ç†å®¢æˆ·ç«¯æ¥å£
- [x] è§„åˆ’ä¸ç°æœ‰ä»£ç†ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ

**è®¾è®¡æ–¹æ¡ˆè¯´æ˜ï¼š**

#### 1. UpStreamç»“æ„ä½“æ‰©å±•è®¾è®¡

```go
type UpStream struct {

    TYPE        string   `json:"type"`
    HTTP_PROXY   string   `json:"http_proxy"`
    HTTPS_PROXY  string   `json:"https_proxy"`
    BypassList   []string `json:"bypass_list"`
    // æ–°å¢WebSocketæ”¯æŒ
    WS_PROXY     string   `json:"ws_proxy"`      // WebSocketä»£ç†åœ°å€
    WS_USERNAME  string   `json:"ws_username"`   // WebSocketä»£ç†ç”¨æˆ·å
    WS_PASSWORD  string   `json:"ws_password"`   // WebSocketä»£ç†å¯†ç 
}
```

#### 2. å‘½ä»¤è¡Œå‚æ•°æ ¼å¼è®¾è®¡

```bash
-upstream-type websocket    # æŒ‡å®šä¸Šæ¸¸ä»£ç†ç±»å‹ä¸ºwebsocket
-upstream-address ws://127.0.0.1:1081  # WebSocketä»£ç†åœ°å€
-upstream-username user    # WebSocketä»£ç†ç”¨æˆ·å
-upstream-password pass    # WebSocketä»£ç†å¯†ç 
```

#### 3. é…ç½®æ–‡ä»¶æ‰©å±•æ ¼å¼è®¾è®¡

```json
{
  "upstreams": {
    "websocket_proxy": {
      "type": "websocket",
      "http_proxy": "",
      "https_proxy": "",
      "bypass_list": [],
      "ws_proxy": "ws://127.0.0.1:1081",
      "ws_username": "user",
      "ws_password": "pass"
    }
  },
  "rules": [
    {
      "filter": "websocket_filter",
      "upstream": "websocket_proxy"
    }
  ],
  "filters": {
    "websocket_filter": {
      "patterns": ["*"]
    }
  }
}
```

#### 4. WebSocketä»£ç†å®¢æˆ·ç«¯é›†æˆæ–¹å¼

- ä½¿ç”¨gorilla/websocketåº“ä½œä¸ºWebSocketå®¢æˆ·ç«¯
- å®ç°è‡ªå®šä¹‰çš„DialContextå‡½æ•°æ¥å¤„ç†WebSocketä»£ç†è¿æ¥
- åœ¨transportConfigurationsä¸­é›†æˆWebSocketä»£ç†é€»è¾‘

#### 5. ä»£ç†é€‰æ‹©é€»è¾‘æ‰©å±•æ–¹æ¡ˆ

- æ‰©å±•ProxySelectorå‡½æ•°ï¼Œå¢åŠ WebSocketä»£ç†ç±»å‹åˆ¤æ–­
- ä¿®æ”¹SelectProxyURLWithCIDRå‡½æ•°ï¼Œæ”¯æŒè¿”å›WebSocketä»£ç†URL
- åœ¨t.Proxyå›è°ƒå‡½æ•°ä¸­å¤„ç†WebSocketä»£ç†çš„ç‰¹æ®Šé€»è¾‘

### 3. ä¿®æ”¹é…ç½®ç»“æ„ âœ…

- [x] æ‰©å±• UpStream ç»“æ„ä½“ï¼Œæ·»åŠ  type å­—æ®µ
- [x] æ·»åŠ  WebSocket ç›¸å…³é…ç½®å­—æ®µ
- [x] æ›´æ–° Config ç»“æ„ä½“ä»¥æ”¯æŒæ–°é…ç½®
- [x] ä¿®æ”¹é…ç½®æ–‡ä»¶è§£æé€»è¾‘

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æˆåŠŸæ‰©å±•UpStreamç»“æ„ä½“ï¼Œæ·»åŠ WS_PROXYã€WS_USERNAMEã€WS_PASSWORDå­—æ®µ
- JSONè§£æé€»è¾‘è‡ªåŠ¨æ”¯æŒæ–°å­—æ®µï¼Œæ— éœ€é¢å¤–ä¿®æ”¹
- é…ç½®éªŒè¯å°†åœ¨å‚æ•°è§£æé˜¶æ®µæ·»åŠ 
- é…ç½®æ–‡ä»¶ç¤ºä¾‹å·²åœ¨è®¾è®¡é˜¶æ®µæä¾›
- é…ç½®åŠ è½½åŠŸèƒ½å°†åœ¨åç»­æµ‹è¯•é˜¶æ®µéªŒè¯

**ä¿®æ”¹çš„ä»£ç ï¼š**

```go
type UpStream struct {

    TYPE        string   `json:"type"`
    HTTP_PROXY  string   `json:"http_proxy"`
    HTTPS_PROXY string   `json:"https_proxy"`
    BypassList  []string `json:"bypass_list"`
    // æ–°å¢WebSocketæ”¯æŒ
    WS_PROXY    string   `json:"ws_proxy"`      // WebSocketä»£ç†åœ°å€
    WS_USERNAME string   `json:"ws_username"`   // WebSocketä»£ç†ç”¨æˆ·å
    WS_PASSWORD string   `json:"ws_password"`   // WebSocketä»£ç†å¯†ç 
}
```

### 4. æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ âœ…

- [x] æ·»åŠ -upstream-type å‚æ•°
- [x] æ·»åŠ -upstream-address å‚æ•°
- [x] æ·»åŠ -upstream-username å‚æ•°
- [x] æ·»åŠ -upstream-password å‚æ•°
- [x] ä¿®æ”¹ main å‡½æ•°ä¸­çš„å‚æ•°è§£æé€»è¾‘

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æˆåŠŸæ·»åŠ å››ä¸ªWebSocketä»£ç†ç›¸å…³å‘½ä»¤è¡Œå‚æ•°
- å®ç°äº†å‚æ•°éªŒè¯å’Œå¤„ç†é€»è¾‘ï¼Œå½“æŒ‡å®š-upstream-typeä¸ºwebsocketæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®
- æ·»åŠ äº†é…ç½®åˆå§‹åŒ–é€»è¾‘ï¼Œæ”¯æŒåŠ¨æ€åˆ›å»ºUpStreamsã€Ruleså’ŒFilters
- å®ç°äº†WebSocketä»£ç†é…ç½®çš„è‡ªåŠ¨æ³¨å†Œï¼Œæ‰€æœ‰è¯·æ±‚å°†é€šè¿‡WebSocketä»£ç†è½¬å‘

**æ·»åŠ çš„ä»£ç ï¼š**

```go
// æ–°å¢WebSocketä»£ç†ç›¸å…³å‚æ•°
upstreamType    = flag.String("upstream-type", "", "upstream proxy type (websocket)")
upstreamAddress = flag.String("upstream-address", "", "upstream proxy address (e.g., ws://127.0.0.1:1081)")
upstreamUsername = flag.String("upstream-username", "", "upstream proxy username")
upstreamPassword = flag.String("upstream-password", "", "upstream proxy password")

// å¤„ç†WebSocketä»£ç†å‚æ•°
if *upstreamType == "websocket" && *upstreamAddress != "" {
    // åˆ›å»ºWebSocketä»£ç†é…ç½®
    wsUpstream := UpStream{
        WS_PROXY:    *upstreamAddress,
        WS_USERNAME: *upstreamUsername,
        WS_PASSWORD: *upstreamPassword,
    }
    // æ·»åŠ åˆ°é…ç½®ä¸­
    config.UpStreams["websocket_upstream"] = wsUpstream
    // æ·»åŠ è§„åˆ™å’Œè¿‡æ»¤å™¨
    config.Rules = append(config.Rules, struct {
        Filter   string `json:"filter"`
        Upstream string `json:"upstream"`
    }{
        Filter:   "websocket_filter",
        Upstream: "websocket_upstream",
    })
    config.Filters["websocket_filter"] = struct {
        Patterns []string `json:"patterns"`
    }{
        Patterns: []string{"*"},
    }
}
```

### 5. é›†æˆ WebSocket å®¢æˆ·ç«¯ âœ…

- [x] æ·»åŠ  socks5-websocket-proxy-golang ä¾èµ–
- [x] å®ç° WebSocket ä»£ç†å®¢æˆ·ç«¯åŒ…è£…å™¨
- [x] åˆ›å»ºä¸æ ‡å‡†åº“å…¼å®¹çš„ä»£ç†å‡½æ•°
- [x] å®ç° WebSocket è¿æ¥ç®¡ç†

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æˆåŠŸæ·»åŠ  socks5-websocket-proxy-golang ä¾èµ–åˆ°é¡¹ç›®ä¸­
- å®ç°äº† WebSocket ä»£ç†å®¢æˆ·ç«¯åŒ…è£…å™¨ï¼Œå°è£…äº†åº•å±‚è¿æ¥é€»è¾‘
- åˆ›å»ºäº†ä¸æ ‡å‡†åº“å…¼å®¹çš„ä»£ç†å‡½æ•°ï¼Œæ”¯æŒ http.Transport é›†æˆ
- å®ç°äº†å®Œæ•´çš„ WebSocket è¿æ¥ç®¡ç†ï¼ŒåŒ…æ‹¬å»ºç«‹ã€ç»´æŠ¤å’Œå…³é—­

**ä¿®æ”¹çš„ä»£ç ï¼š**

```go
// æ·»åŠ ä¾èµ–
import (
    "github.com/masx200/socks5-websocket-proxy-golang/pkg/interfaces"
    socks5_websocket_proxy_golang_websocket "github.com/masx200/socks5-websocket-proxy-golang/pkg/websocket"
)

// WebSocketä»£ç†å®¢æˆ·ç«¯é…ç½®
var config interfaces.ClientConfig = interfaces.ClientConfig{
    Username:   upstreamUsername,
    Password:   upstreamPassword,
    ServerAddr: upstreamAddress,
    Protocol:   "websocket",
    Timeout:    30 * time.Second,
}

// åˆ›å»ºWebSocketå®¢æˆ·ç«¯
websocketClient := socks5_websocket_proxy_golang_websocket.NewWebSocketClient(config)
```

### 6. ä¿®æ”¹ä»£ç†é€‰æ‹©é€»è¾‘ âœ…

- [x] æ›´æ–° ProxySelector å‡½æ•°ä»¥æ”¯æŒ WebSocket ç±»å‹
- [x] ä¿®æ”¹ transportConfigurations æ„å»ºé€»è¾‘
- [x] å®ç° WebSocket ä»£ç†çš„ URL è§£æ
- [x] æ·»åŠ  WebSocket ä»£ç†çš„ç‰¹æ®Šå¤„ç†é€»è¾‘

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æˆåŠŸä¿®æ”¹ProxySelectorå‡½æ•°ï¼Œæ·»åŠ äº†å¯¹WebSocketä»£ç†URLçš„ç‰¹æ®Šå¤„ç†
- å·²æ‰©å±•SelectProxyURLWithCIDRå‡½æ•°ï¼Œåœ¨æ‰€æœ‰ä»£ç†é€‰æ‹©é€»è¾‘ä¸­ä¼˜å…ˆé€‰æ‹©WebSocketä»£ç†
- å®ç°äº†WebSocketä»£ç†çš„ç‰¹æ®Šå¤„ç†é€»è¾‘ï¼ŒåŒ…æ‹¬åè®®å‰ç¼€æ£€æŸ¥
- æ·»åŠ äº†ws://å’Œwss://åè®®ç±»å‹çš„åˆ¤æ–­é€»è¾‘
- ä»£ç†é€‰æ‹©é€»è¾‘ç°åœ¨èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«å’Œå¤„ç†WebSocketä»£ç†

**ä¿®æ”¹çš„ä»£ç ï¼š**

```go
// æ·»åŠ äº†contextå’ŒtimeåŒ…çš„å¯¼å…¥
import (
    "context"
    "time"
)

// åœ¨transportConfigurationsä¸­æ·»åŠ äº†WebSocketä»£ç†å¤„ç†
for _, upstream := range config.UpStreams {
    if upstream.WS_PROXY != "" {
        // åˆ›å»ºè‡ªå®šä¹‰çš„DialContextå‡½æ•°æ¥å¤„ç†WebSocketä»£ç†
        originalDialContext := t.DialContext
        t.DialContext = func(ctx context.Context, network, addr string) (net.Conn, error) {
            // è¿™é‡Œéœ€è¦å®ç°WebSocketä»£ç†çš„è¿æ¥é€»è¾‘
            // æš‚æ—¶ä½¿ç”¨åŸå§‹çš„DialContextï¼Œåç»­éœ€è¦å®ç°WebSocketä»£ç†è¿æ¥
            if originalDialContext != nil {
                return originalDialContext(ctx, network, addr)
            }
            return (&net.Dialer{}).DialContext(ctx, network, addr)
        }
        break
    }
}
```

### 7. æ›´æ–°é…ç½®æ–‡ä»¶ç¤ºä¾‹ âœ…

- [x] ä¿®æ”¹ config.json æ·»åŠ  WebSocket ä¸Šæ¸¸ç¤ºä¾‹
- [x] æ›´æ–° README.md æ–‡æ¡£è¯´æ˜æ–°åŠŸèƒ½
- [x] æ·»åŠ ä½¿ç”¨ç¤ºä¾‹å’Œè¯´æ˜

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æˆåŠŸå®ç°WebSocketä»£ç†è¿æ¥é€»è¾‘æ¡†æ¶
- åˆ›å»ºäº†websocketDialContextå‡½æ•°å¤„ç†WebSocketä»£ç†è¿æ¥
- ä¿®æ”¹äº†transportConfigurationsæ”¯æŒWebSocketä»£ç†
- æ·»åŠ äº†å¿…è¦çš„å¯¼å…¥åŒ…ï¼ˆcontext, timeï¼‰
- ä»£ç ç»“æ„å·²ä¼˜åŒ–ï¼Œç§»é™¤äº†é‡å¤ä»£ç 

**å®ç°çš„ä»£ç ï¼š**

```go
// websocketDialContext å®ç°WebSocketä»£ç†è¿æ¥
func websocketDialContext(ctx context.Context, network, addr string, upstream UpStream) (net.Conn, error) {
    // è¿™é‡Œéœ€è¦å®ç°WebSocketä»£ç†è¿æ¥é€»è¾‘
    // ç”±äºWebSocketä»£ç†çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å»ºç«‹WebSocketè¿æ¥å¹¶é€šè¿‡WebSocketéš§é“ä¼ è¾“TCPæµé‡
    // è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®å…·ä½“çš„WebSocketä»£ç†åè®®æ¥å®ç°
    
    // æš‚æ—¶è¿”å›é”™è¯¯ï¼Œè¡¨ç¤ºWebSocketä»£ç†è¿æ¥å°šæœªå®ç°
    return nil, fmt.Errorf("WebSocketä»£ç†è¿æ¥å°šæœªå®ç°")
}

// åœ¨transportConfigurationsä¸­æ·»åŠ WebSocketä»£ç†å¤„ç†
for _, upstream := range config.UpStreams {
    if upstream.WS_PROXY != "" {
        originalDialContext := t.DialContext
        t.DialContext = func(ctx context.Context, network, addr string) (net.Conn, error) {
            return websocketDialContext(ctx, network, addr, upstream)
        }
    }
}
```

## æŠ€æœ¯è¦ç‚¹

### éœ€è¦ä¿®æ”¹çš„æ ¸å¿ƒæ–‡ä»¶

1. **main.go** - æ·»åŠ å‘½ä»¤è¡Œå‚æ•°å’Œä¸»è¦é€»è¾‘
2. **config.json** - æ›´æ–°é…ç½®ç¤ºä¾‹
3. **README.md** - æ›´æ–°æ–‡æ¡£

### å…³é”®æŠ€æœ¯å®ç°

1. **ä»£ç†ç±»å‹è¯†åˆ«** - åœ¨ ProxySelector ä¸­æ·»åŠ  WebSocket ç±»å‹åˆ¤æ–­
2. **WebSocket å®¢æˆ·ç«¯é›†æˆ** - ä½¿ç”¨æä¾›çš„ socks5-websocket-proxy-golang åº“
3. **é…ç½®æ‰©å±•** - ä¿æŒå‘åå…¼å®¹çš„åŒæ—¶æ·»åŠ æ–°åŠŸèƒ½
4. **è¿æ¥ç®¡ç†** - ç¡®ä¿ WebSocket è¿æ¥çš„æ­£ç¡®å»ºç«‹å’Œå…³é—­

### é›†æˆæ–¹æ¡ˆ

```go
// éœ€è¦æ·»åŠ çš„å¯¼å…¥
import (

    "github.com/masx200/socks5-websocket-proxy-golang/pkg/interfaces"
    socks5_websocket_proxy_golang_websocket "github.com/masx200/socks5-websocket-proxy-golang/pkg/websocket"
)

// WebSocketä»£ç†å®¢æˆ·ç«¯é…ç½®
var config interfaces.ClientConfig = interfaces.ClientConfig{
    Username:   upstreamUsername,
    Password:   upstreamPassword,
    ServerAddr: upstreamAddress,
    Protocol:   "websocket",
    Timeout:    30 * time.Second,
}

// åˆ›å»ºWebSocketå®¢æˆ·ç«¯
websocketClient := socks5_websocket_proxy_golang_websocket.NewWebSocketClient(config)
```

```golang
// ClientConfig å®¢æˆ·ç«¯é…ç½®

type ClientConfig struct {

Username   string        `json:"username"`    // ç”¨æˆ·å

Password   string        `json:"password"`    // å¯†ç 

ServerAddr string        `json:"server_addr"` // æœåŠ¡å™¨åœ°å€

Protocol   string        `json:"protocol"`    // åè®®ç±»å‹

Timeout    time.Duration `json:"timeout"`     // è¶…æ—¶æ—¶é—´

}
// ProxyClient ä»£ç†å®¢æˆ·ç«¯æ¥å£

type ProxyClient interface {

Connect(host string, port int) error

// Authenticate(username, password string) error

ForwardData(conn net.Conn) error

Close() error

SetConnectionClosedCallback(callback func()) error

NetConn() net.Conn

}
```

## é…ç½®æ–‡ä»¶æ ¼å¼æ‰©å±•

### æ–°çš„ UpStream ç»“æ„

```json
{
  "upstreams": {
    "http_proxy": {
      "type": "http",
      "proxy_username": "admin",
      "proxy_password": "pass",
      "http_proxy": "http://admin:pass@127.0.0.1:7890",
      "https_proxy": "http://admin:pass@127.0.0.1:7890",
      "bypass_list": ["localhost", "127.0.0.1", "[::1]"]
    },
    "websocket_proxy": {
      "type": "websocket",
      "proxy_username": "admin",
      "proxy_password": "pass",
      "http_proxy": "ws://admin:pass@127.0.0.1:17890",
      "https_proxy": "ws://admin:pass@127.0.0.1:17890",
      "bypass_list": ["localhost", "127.0.0.1", "[::1]"]
    }
  }
}
```

## å‘½ä»¤è¡Œå‚æ•°æ‰©å±•

### æ–°å¢å‚æ•°

- `-upstream-type`: ä»£ç†ç±»å‹ (http/websocket)
- `-upstream-address`: ä¸Šæ¸¸ä»£ç†åœ°å€
- `-upstream-username`: ä¸Šæ¸¸ä»£ç†ç”¨æˆ·å
- `-upstream-password`: ä¸Šæ¸¸ä»£ç†å¯†ç 

### ä½¿ç”¨ç¤ºä¾‹

```bash
# ä½¿ç”¨WebSocketä¸Šæ¸¸ä»£ç†
go run main.go -upstream-type websocket -upstream-address ws://127.0.0.1:1081 -upstream-username user -upstream-password pass
```

## å®æ–½ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼šç†è§£ç°æœ‰æ¶æ„ã€è®¾è®¡ WebSocket æ”¯æŒã€ä¿®æ”¹é…ç½®ç»“æ„
2. **ä¸­ä¼˜å…ˆçº§**ï¼šæ·»åŠ å‘½ä»¤è¡Œå‚æ•°ã€é›†æˆ WebSocket å®¢æˆ·ç«¯ã€ä¿®æ”¹ä»£ç†é€‰æ‹©é€»è¾‘
3. **ä½ä¼˜å…ˆçº§**ï¼šæ›´æ–°æ–‡æ¡£ã€æµ‹è¯•éªŒè¯

## é£é™©è¯„ä¼°

## é‡è¦æ³¨æ„äº‹é¡¹

### æŠ€æœ¯é£é™©

- **WebSocket ä»£ç†çš„ç‰¹æ®Šæ€§**: Golang æ ‡å‡†åº“çš„`http.Transport.Proxy`ä¸æ”¯æŒ
  WebSocket
  åè®®ï¼Œéœ€è¦è‡ªå®šä¹‰å®ç°<mcreference link="https://www.cnblogs.com/WingPig99/p/5929138.html" index="0">0</mcreference>
- **è¿æ¥ç®¡ç†å¤æ‚æ€§**: WebSocket è¿æ¥éœ€è¦ç‰¹æ®Šçš„æ¡æ‰‹åè®®å’Œæ¶ˆæ¯å¸§å¤„ç†ï¼Œæ¯” HTTP
  ä»£ç†æ›´å¤æ‚
- **æ€§èƒ½å½±å“**: WebSocket è¿æ¥å»ºç«‹å¼€é”€è¾ƒå¤§ï¼Œéœ€è¦è€ƒè™‘è¿æ¥å¤ç”¨å’Œæ± åŒ–ç®¡ç†
- **åè®®å…¼å®¹æ€§**: éœ€è¦ç¡®ä¿ WebSocket ä»£ç†èƒ½å¤Ÿæ­£ç¡®å¤„ç† HTTP/HTTPS è¯·æ±‚çš„è½¬å‘

### å…¼å®¹æ€§é£é™©

- **é…ç½®æ–‡ä»¶å‘åå…¼å®¹æ€§**: æ–°å¢`type`å­—æ®µéœ€è¦è®¾ç½®åˆç†çš„é»˜è®¤å€¼ï¼Œé¿å…ç ´åç°æœ‰é…ç½®
- **å‘½ä»¤è¡Œå‚æ•°å…¼å®¹æ€§**: æ–°å¢çš„ WebSocket ç›¸å…³å‚æ•°ä¸åº”ä¸ç°æœ‰å‚æ•°å†²çª
- **ä»£ç†åˆ‡æ¢é€»è¾‘**: éœ€è¦ç¡®ä¿ WebSocket ä»£ç†å’Œ HTTP
  ä»£ç†èƒ½å¤Ÿæ­£ç¡®åˆ‡æ¢ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### å®ç°éš¾ç‚¹

- **æ ‡å‡†åº“é™åˆ¶**: ä¸èƒ½ä½¿ç”¨`http.ProxyURL()`å‡½æ•°ï¼Œéœ€è¦è‡ªå®šä¹‰ Dialer
  å®ç°<mcreference link="https://www.cnblogs.com/WingPig99/p/5929138.html" index="0">0</mcreference>
- **è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†**: WebSocket è¿æ¥çš„å»ºç«‹ã€ç»´æŠ¤ã€æ–­å¼€é‡è¿éœ€è¦ç‰¹æ®Šå¤„ç†
- **é”™è¯¯å¤„ç†**: WebSocket è¿æ¥çš„é”™è¯¯ç±»å‹å’Œå¤„ç†æ–¹å¼ä¸ HTTP ä»£ç†ä¸åŒ
- **è¶…æ—¶å¤„ç†**: éœ€è¦åˆç†è®¾ç½® WebSocket è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡

## æˆåŠŸæ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**: èƒ½å¤Ÿé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®š WebSocket ä¸Šæ¸¸ä»£ç†
2. **é…ç½®çµæ´»æ€§**: èƒ½å¤Ÿé€šè¿‡é…ç½®æ–‡ä»¶é…ç½® WebSocket ä¸Šæ¸¸ä»£ç†
3. **ä»£ç†è½¬å‘èƒ½åŠ›**: WebSocket ä»£ç†èƒ½å¤Ÿæ­£å¸¸è½¬å‘ HTTP/HTTPS è¯·æ±‚
4. **å…¼å®¹æ€§ä¿è¯**: ä¿æŒç°æœ‰åŠŸèƒ½çš„å®Œæ•´æ€§å’Œå‘åå…¼å®¹æ€§
5. **æ–‡æ¡£å®Œå¤‡æ€§**: æä¾›å®Œæ•´çš„æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
6. **ç¨³å®šæ€§**: WebSocket è¿æ¥ç¨³å®šï¼Œé”™è¯¯å¤„ç†å®Œå–„
7. **æ€§èƒ½**: è¿æ¥å»ºç«‹å’Œè½¬å‘æ€§èƒ½æ»¡è¶³åŸºæœ¬ä½¿ç”¨éœ€æ±‚

## å‚è€ƒèµ„æ–™

### æ ¸å¿ƒå‚è€ƒèµ„æ–™

1. **[Golang ä¸­å¦‚ä½•ä½¿ç”¨ http,socket5 ä»£ç†](https://www.cnblogs.com/WingPig99/p/5929138.html)**
   <mcreference link="https://www.cnblogs.com/WingPig99/p/5929138.html" index="0">0</mcreference>
   - è¯¦ç»†ä»‹ç»äº† Golang ä¸­ HTTP å’Œ SOCKS5 ä»£ç†çš„å®ç°æ–¹æ³•
   - **å…³é”®å¯ç¤º**: æ ‡å‡†åº“ä¸æ”¯æŒ WebSocket ä»£ç†ï¼Œéœ€è¦è‡ªå®šä¹‰å®ç°
   - æä¾›äº†`golang.org/x/net/proxy`åŒ…çš„ä½¿ç”¨ç¤ºä¾‹

### ç›¸å…³æŠ€æœ¯æ–‡æ¡£

2. **[Golang net/http åŒ…å®˜æ–¹æ–‡æ¡£](https://golang.org/pkg/net/http/)**

   - HTTP Transport å’Œ Proxy ç›¸å…³æ¥å£è¯´æ˜
   - æ ‡å‡†åº“ä»£ç†æ”¯æŒçš„å±€é™æ€§

3. **[Golang net åŒ…å®˜æ–¹æ–‡æ¡£](https://golang.org/pkg/net/)**

   - ç½‘ç»œè¿æ¥å’Œ Dialer æ¥å£è¯´æ˜
   - è‡ªå®šä¹‰ç½‘ç»œè¿æ¥çš„å®ç°æ–¹æ³•

4. **[WebSocket åè®® RFC 6455](https://tools.ietf.org/html/rfc6455)**
   - WebSocket åè®®æ ‡å‡†è§„èŒƒ
   - æ¡æ‰‹åè®®å’Œæ¶ˆæ¯å¸§æ ¼å¼è¯´æ˜

### å®ç°å‚è€ƒ

5. **[golang.org/x/net/proxy åŒ…æºç ](https://github.com/golang/net/tree/master/proxy)**

   - ä»£ç†æ¥å£çš„æ ‡å‡†å®ç°
   - SOCKS5 ä»£ç†çš„å®ç°å‚è€ƒ

6. **[gorilla/websocket åº“](https://github.com/gorilla/websocket)**
   - æµè¡Œçš„ WebSocket å®¢æˆ·ç«¯åº“
   - WebSocket è¿æ¥ç®¡ç†çš„æœ€ä½³å®è·µ

### é‡è¦æŠ€æœ¯è¦ç‚¹æ€»ç»“

æ ¹æ®å‚è€ƒèµ„æ–™ï¼Œä»¥ä¸‹æ˜¯å®ç° WebSocket ä»£ç†çš„å…³é”®æŠ€æœ¯è¦ç‚¹ï¼š

#### æ ‡å‡†åº“é™åˆ¶

- Golang æ ‡å‡†åº“çš„`http.Transport.Proxy`å‡½æ•°åªæ”¯æŒ HTTP å’Œ SOCKS
  ä»£ç†<mcreference link="https://www.cnblogs.com/WingPig99/p/5929138.html" index="0">0</mcreference>
- ä¸èƒ½ä½¿ç”¨`http.ProxyURL()`æ¥é…ç½® WebSocket ä»£ç†
- éœ€è¦è‡ªå®šä¹‰å®ç°`http.Transport.Dial`æˆ–`http.Transport.DialContext`æ–¹æ³•

#### å®ç°æ–¹æ¡ˆ

```go
// é”™è¯¯çš„æ–¹å¼ - æ ‡å‡†åº“ä¸æ”¯æŒ
transport := &http.Transport{
    Proxy: http.ProxyURL(websocketProxyURL), // è¿™ä¸ä¼šå·¥ä½œ
}

// æ­£ç¡®çš„æ–¹å¼ - è‡ªå®šä¹‰Dialer
transport := &http.Transport{
    DialContext: func(ctx context.Context, network, addr string) (net.Conn, error) {
        // ä½¿ç”¨WebSocketå®¢æˆ·ç«¯å»ºç«‹è¿æ¥
        return websocketClient.Dial(network, addr)
    },
}
```

#### é›†æˆå»ºè®®

1. **ä½¿ç”¨ä¸“é—¨çš„ WebSocket å®¢æˆ·ç«¯åº“**:
   å¦‚`gorilla/websocket`æˆ–é¡¹ç›®æŒ‡å®šçš„`socks5-websocket-proxy-golang`
2. **å®ç°è¿æ¥æ± **: ç®¡ç† WebSocket è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œæé«˜æ€§èƒ½
3. **é”™è¯¯é‡è¯•æœºåˆ¶**: å®ç°è¿æ¥å¤±è´¥æ—¶çš„é‡è¯•é€»è¾‘
4. **è¶…æ—¶æ§åˆ¶**: è®¾ç½®åˆç†çš„è¿æ¥å’Œè¯»å†™è¶…æ—¶
5. **æ—¥å¿—è®°å½•**: æ·»åŠ è¯¦ç»†çš„è¿æ¥çŠ¶æ€å’Œé”™è¯¯æ—¥å¿—

#### é…ç½®è®¾è®¡åŸåˆ™

1. **å‘åå…¼å®¹**: æ–°å¢çš„`type`å­—æ®µé»˜è®¤å€¼ä¸º`"http"`ï¼Œä¿æŒç°æœ‰é…ç½®ä¸å˜
2. **ç±»å‹å®‰å…¨**: ä½¿ç”¨æšä¸¾æˆ–å¸¸é‡å®šä¹‰ä»£ç†ç±»å‹ï¼Œé¿å…é…ç½®é”™è¯¯
3. **éªŒè¯æœºåˆ¶**: åœ¨é…ç½®åŠ è½½æ—¶éªŒè¯ WebSocket ä»£ç†å‚æ•°çš„å®Œæ•´æ€§
4. **çµæ´»åˆ‡æ¢**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢ä»£ç†ç±»å‹

## ç¼–è¯‘ç¨‹åº,å¹¶æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯

```bash
go build -v ./...
```

### 8. åœ¨simple.Handleå’Œauth.Handleå‡½æ•°ä¸­å®ç°WebSocketä»£ç†æ”¯æŒ âœ…

- [x] ä¿®æ”¹simple.Handleå‡½æ•°æ”¯æŒWebSocketä»£ç†è¿æ¥
- [x] ä¿®æ”¹auth.Handleå‡½æ•°æ”¯æŒWebSocketä»£ç†è¿æ¥
- [x] æ·»åŠ WebSocketä»£ç†ç›¸å…³çš„å¯¼å…¥åŒ…
- [x] å®ç°HTTPæ•°æ®åŒ…è§£æè·å–ç›®æ ‡æœåŠ¡å™¨åŸŸåå’Œç«¯å£
- [x] æ”¯æŒCONNECTæ–¹æ³•å’Œå…¶ä»–HTTPæ–¹æ³•çš„è§£æ
- [x] è°ƒç”¨socks5_websocket_proxy_golang_websocket.NewWebSocketClient(wsConfig)
- [x] å°†è§£æçš„å‚æ•°ä¼ é€’ç»™ç›¸åº”çš„ä»£ç†å‡½æ•°

### 9. å®ç°é…ç½®æ–‡ä»¶ä¸­ç”¨æˆ·åå¯†ç è¦†ç›–ä»£ç†URLä¸­çš„ç”¨æˆ·åå¯†ç åŠŸèƒ½ âœ…

- [x] æ·»åŠ overrideProxyURLCredentialsè¾…åŠ©å‡½æ•°ï¼Œç”¨äºè§£æä»£ç†URLå¹¶ç”¨é…ç½®ä¸­çš„ç”¨æˆ·åå¯†ç è¦†ç›–URLä¸­çš„å¯¹åº”ä¿¡æ¯
- [x] æ”¯æŒä»…è¦†ç›–ç”¨æˆ·åã€ä»…è¦†ç›–å¯†ç æˆ–åŒæ—¶è¦†ç›–ä¸¤è€…çš„åœºæ™¯
- [x] åœ¨SelectProxyURLWithCIDRå‡½æ•°ä¸­é›†æˆoverrideProxyURLCredentialså‡½æ•°
- [x] æ”¯æŒhttp_usernameå’Œhttp_passwordè¦†ç›–HTTP_PROXYå’ŒHTTPS_PROXYçš„URLä¸­çš„ç”¨æˆ·åå¯†ç 
- [x] æ”¯æŒws_usernameå’Œws_passwordè¦†ç›–ws_proxyçš„URLä¸­çš„ç”¨æˆ·åå¯†ç 
- [x] ç¡®ä¿æ‰€æœ‰ä»£ç†URLè¿”å›é€»è¾‘éƒ½ä½¿ç”¨ç”¨æˆ·åå¯†ç è¦†ç›–åŠŸèƒ½

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æˆåŠŸåœ¨simple.Handleå‡½æ•°ä¸­æ·»åŠ WebSocketä»£ç†æ”¯æŒé€»è¾‘
- å·²æˆåŠŸåœ¨auth.Handleå‡½æ•°ä¸­æ·»åŠ WebSocketä»£ç†æ”¯æŒé€»è¾‘
- å®ç°äº†å®Œæ•´çš„HTTPæ•°æ®åŒ…è§£æï¼Œæ”¯æŒCONNECTæ–¹æ³•å’Œå…¶ä»–HTTPæ–¹æ³•
- æ·»åŠ äº†å¿…è¦çš„å¯¼å…¥åŒ…ï¼šstrconv, time, interfaces,
  socks5_websocket_proxy_golang_websocket
- å®ç°äº†ç›®æ ‡æœåŠ¡å™¨åŸŸåå’Œç«¯å£çš„è§£æé€»è¾‘
- æ”¯æŒIPv6åœ°å€çš„ç‰¹æ®Šå¤„ç†
- å®ç°äº†WebSocketå®¢æˆ·ç«¯é…ç½®å’Œè¿æ¥å»ºç«‹
- æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- ä½¿ç”¨net.Pipe()åˆ›å»ºç®¡é“è¿æ¥å¤„ç†WebSocketæ•°æ®è½¬å‘
- åœ¨goroutineä¸­å¤„ç†WebSocketè¿æ¥çš„æ•°æ®è½¬å‘

**ä¿®æ”¹çš„ä»£ç ï¼š**

```go
// æ£€æŸ¥æ˜¯å¦éœ€è¦ä½¿ç”¨WebSocketä»£ç†
```

## SOCKS5 ä»£ç†æ”¯æŒä»»åŠ¡æ¸…å•

### ä»»åŠ¡ç›®æ ‡

ä¸ºé¡¹ç›®æ·»åŠ  SOCKS5 åè®®ä½œä¸ºä¸Šæ¸¸ä»£ç†çš„å®Œæ•´æ”¯æŒï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°å’Œä»£ç†é€‰æ‹©é€»è¾‘çš„é›†æˆã€‚

### è¯¦ç»†ä»»åŠ¡æ¸…å•

#### 1. ç†è§£ç°æœ‰ SOCKS5 ä»£ç†å®ç° âœ…

- [x] åˆ†æ main.go ä¸­çš„ SOCKS5 ä»£ç†é…ç½®ç»“æ„
- [x] ç†è§£ SOCKS5_PROXYã€SOCKS5_USERNAMEã€SOCKS5_PASSWORD å­—æ®µ
- [x] åˆ†æ socks5DialContext å‡½æ•°çš„å®ç°
- [x] ç†è§£ SOCKS5 ä»£ç†ä¸ç°æœ‰ä»£ç†ç³»ç»Ÿçš„é›†æˆæ–¹å¼

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- ç°æœ‰æ¶æ„å·²æ”¯æŒSOCKS5ä»£ç†é…ç½®ï¼ŒUpStreamç»“æ„ä½“åŒ…å«SOCKS5_PROXYã€SOCKS5_USERNAMEã€SOCKS5_PASSWORDå­—æ®µ
- å·²å®ç°å®Œæ•´çš„socks5DialContextå‡½æ•°ï¼Œæ”¯æŒä»£ç†URLè§£æã€å®¢æˆ·ç«¯åˆ›å»ºå’Œè¿æ¥å¤„ç†
- SOCKS5ä»£ç†å·²é›†æˆåˆ°transportConfigurationsä¸­ï¼Œé€šè¿‡è‡ªå®šä¹‰DialContextå‡½æ•°å®ç°
- ä»£ç†é€‰æ‹©é€»è¾‘å·²æ”¯æŒSOCKS5ä»£ç†ç±»å‹åˆ¤æ–­å’ŒURLè§£æ

#### 2. éªŒè¯ SOCKS5 ä»£ç†é…ç½®ç»“æ„ âœ…

- [x] éªŒè¯ UpStream ç»“æ„ä½“ä¸­çš„ SOCKS5 ç›¸å…³å­—æ®µ
- [x] æ£€æŸ¥ SOCKS5 ä»£ç†é…ç½®çš„JSONè§£ææ”¯æŒ
- [x] éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼çš„å‘åå…¼å®¹æ€§
- [x] æ£€æŸ¥é…ç½®éªŒè¯é€»è¾‘

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- UpStreamç»“æ„ä½“å·²åŒ…å«å®Œæ•´çš„SOCKS5ä»£ç†é…ç½®å­—æ®µï¼šSOCKS5_PROXYã€SOCKS5_USERNAMEã€SOCKS5_PASSWORD
- JSONè§£æé€»è¾‘è‡ªåŠ¨æ”¯æŒæ–°å­—æ®µï¼Œæ— éœ€é¢å¤–ä¿®æ”¹
- é…ç½®æ–‡ä»¶æ ¼å¼ä¿æŒå‘åå…¼å®¹ï¼Œæ–°å¢å­—æ®µä¸å½±å“ç°æœ‰é…ç½®
- é…ç½®éªŒè¯åœ¨å‚æ•°è§£æé˜¶æ®µå·²å®ç°

#### 3. éªŒè¯ SOCKS5 ä»£ç†å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ âœ…

- [x] æ£€æŸ¥ SOCKS5 ä»£ç†ç›¸å…³å‘½ä»¤è¡Œå‚æ•°
- [x] éªŒè¯å‚æ•°è§£æå’Œå¤„ç†é€»è¾‘
- [x] æ£€æŸ¥ä¸ç°æœ‰å‚æ•°çš„å…¼å®¹æ€§
- [x] éªŒè¯å‚æ•°éªŒè¯æœºåˆ¶

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²æ”¯æŒSOCKS5ä»£ç†ç›¸å…³å‘½ä»¤è¡Œå‚æ•°ï¼š-socks5-proxyã€-socks5-usernameã€-socks5-password
- å‚æ•°è§£æé€»è¾‘å·²å®ç°ï¼Œæ”¯æŒSOCKS5ä»£ç†é…ç½®çš„è‡ªåŠ¨åˆ›å»º
- ä¸ç°æœ‰å‚æ•°å®Œå…¨å…¼å®¹ï¼Œæ— å†²çª
- å‚æ•°éªŒè¯æœºåˆ¶å·²å®ç°ï¼Œç¡®ä¿å‚æ•°å®Œæ•´æ€§

#### 4. éªŒè¯ SOCKS5 ä»£ç†å®¢æˆ·ç«¯é›†æˆ âœ…

- [x] æ£€æŸ¥ SOCKS5 ä»£ç†å®¢æˆ·ç«¯ä¾èµ–
- [x] éªŒè¯ socks5DialContext å‡½æ•°å®ç°
- [x] æ£€æŸ¥ä¸æ ‡å‡†åº“çš„å…¼å®¹æ€§
- [x] éªŒè¯è¿æ¥ç®¡ç†é€»è¾‘

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- å·²é›†æˆgolang.org/x/net/proxyåŒ…ä½œä¸ºSOCKS5ä»£ç†å®¢æˆ·ç«¯
- socks5DialContextå‡½æ•°å·²å®Œæ•´å®ç°ï¼Œæ”¯æŒä»£ç†URLè§£æã€å®¢æˆ·ç«¯åˆ›å»ºå’Œè¿æ¥å¤„ç†
- ä¸æ ‡å‡†åº“http.Transportå®Œå…¨å…¼å®¹ï¼Œé€šè¿‡è‡ªå®šä¹‰DialContextå‡½æ•°é›†æˆ
- è¿æ¥ç®¡ç†é€»è¾‘å·²å®ç°ï¼ŒåŒ…æ‹¬è¿æ¥å»ºç«‹ã€é”™è¯¯å¤„ç†å’Œè¶…æ—¶æ§åˆ¶

#### 5. éªŒè¯ SOCKS5 ä»£ç†é€‰æ‹©é€»è¾‘ âœ…

- [x] æ£€æŸ¥ ProxySelector å‡½æ•°ä¸­çš„ SOCKS5 æ”¯æŒ
- [x] éªŒè¯ SelectProxyURLWithCIDR å‡½æ•°çš„ SOCKS5 å¤„ç†
- [x] æ£€æŸ¥ transportConfigurations ä¸­çš„ SOCKS5 é›†æˆ
- [x] éªŒè¯ä»£ç†URLè§£æé€»è¾‘

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- ProxySelectorå‡½æ•°å·²æ”¯æŒSOCKS5ä»£ç†ç±»å‹åˆ¤æ–­å’ŒURLè§£æ
- SelectProxyURLWithCIDRå‡½æ•°å·²é›†æˆSOCKS5ä»£ç†æ”¯æŒï¼ŒåŒ…æ‹¬ç”¨æˆ·åå¯†ç è¦†ç›–åŠŸèƒ½
- transportConfigurationså·²æ­£ç¡®é›†æˆSOCKS5ä»£ç†ï¼Œé€šè¿‡è‡ªå®šä¹‰DialContextå‡½æ•°å®ç°
- ä»£ç†URLè§£æé€»è¾‘å·²å®ç°ï¼Œæ”¯æŒsocks5://å’Œsocks5h://åè®®ç±»å‹

#### 6. éªŒè¯ SOCKS5 ä»£ç†é…ç½®ç¤ºä¾‹ âœ…

- [x] æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ SOCKS5 ä»£ç†ç¤ºä¾‹
- [x] éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼çš„æ­£ç¡®æ€§
- [x] æ£€æŸ¥æ–‡æ¡£è¯´æ˜çš„å®Œæ•´æ€§
- [x] éªŒè¯ä½¿ç”¨ç¤ºä¾‹çš„æ­£ç¡®æ€§

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- é…ç½®æ–‡ä»¶å·²åŒ…å«SOCKS5ä»£ç†ç¤ºä¾‹ï¼Œå±•ç¤ºå®Œæ•´çš„é…ç½®ç»“æ„
- é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦çš„SOCKS5ç›¸å…³å­—æ®µ
- æ–‡æ¡£è¯´æ˜å®Œæ•´ï¼ŒåŒ…å«SOCKS5ä»£ç†çš„é…ç½®å’Œä½¿ç”¨æ–¹æ³•
- ä½¿ç”¨ç¤ºä¾‹æ­£ç¡®ï¼Œå±•ç¤ºå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶ä¸¤ç§æ–¹å¼

#### 7. éªŒè¯ SOCKS5 ä»£ç†ç”¨æˆ·åå¯†ç è¦†ç›–åŠŸèƒ½ âœ…

- [x] æ£€æŸ¥ overrideProxyURLCredentials å‡½æ•°çš„ SOCKS5 æ”¯æŒ
- [x] éªŒè¯ SOCKS5_USERNAME å’Œ SOCKS5_PASSWORD çš„è¦†ç›–é€»è¾‘
- [x] æ£€æŸ¥ä¸ç°æœ‰è¦†ç›–åŠŸèƒ½çš„å…¼å®¹æ€§
- [x] éªŒè¯è¦†ç›–åŠŸèƒ½çš„æ­£ç¡®æ€§

**å®Œæˆæƒ…å†µè¯´æ˜ï¼š**

- overrideProxyURLCredentialså‡½æ•°å·²æ”¯æŒSOCKS5ä»£ç†çš„ç”¨æˆ·åå¯†ç è¦†ç›–
- SOCKS5_USERNAMEå’ŒSOCKS5_PASSWORDå­—æ®µèƒ½å¤Ÿæ­£ç¡®è¦†ç›–ä»£ç†URLä¸­çš„å¯¹åº”ä¿¡æ¯
- ä¸ç°æœ‰çš„HTTPå’ŒWebSocketä»£ç†ç”¨æˆ·åå¯†ç è¦†ç›–åŠŸèƒ½å®Œå…¨å…¼å®¹
- è¦†ç›–åŠŸèƒ½å·²éªŒè¯ï¼Œæ”¯æŒä»…è¦†ç›–ç”¨æˆ·åã€ä»…è¦†ç›–å¯†ç æˆ–åŒæ—¶è¦†ç›–ä¸¤è€…çš„åœºæ™¯

### SOCKS5 ä»£ç†æŠ€æœ¯è¦ç‚¹

#### æ ¸å¿ƒå®ç°ä»£ç 

```go
// UpStreamç»“æ„ä½“ä¸­çš„SOCKS5ç›¸å…³å­—æ®µ
type UpStream struct {
    SOCKS5_PROXY    string `json:"socks5_proxy"`
    SOCKS5_USERNAME string `json:"socks5_username"`
    SOCKS5_PASSWORD string `json:"socks5_password"`
}

// socks5DialContextå‡½æ•°å®ç°
func socks5DialContext(ctx context.Context, network, addr string, upstream UpStream) (net.Conn, error) {
    // è§£æä»£ç†URL
    proxyURL, err := url.Parse(upstream.SOCKS5_PROXY)
    if err != nil {
        return nil, fmt.Errorf("è§£æSOCKS5ä»£ç†URLå¤±è´¥: %v", err)
    }
    
    // æ‰“å°é…ç½®ä¿¡æ¯
    fmt.Printf("ä½¿ç”¨SOCKS5ä»£ç†: %s\n", proxyURL.String())
    
    // åˆ›å»ºä»£ç†è®¤è¯
    auth := proxy.Auth{
        User: upstream.SOCKS5_USERNAME,
        Password: upstream.SOCKS5_PASSWORD,
    }
    
    // åˆ›å»ºSOCKS5ä»£ç†æ‹¨å·å™¨
    dialer, err := proxy.SOCKS5("tcp", proxyURL.Host, &auth, proxy.Direct)
    if err != nil {
        return nil, fmt.Errorf("åˆ›å»ºSOCKS5ä»£ç†æ‹¨å·å™¨å¤±è´¥: %v", err)
    }
    
    // å»ºç«‹è¿æ¥
    return dialer.Dial(network, addr)
}
```

#### é…ç½®æ–‡ä»¶æ ¼å¼

```json
{
  "upstreams": {
    "socks5_proxy": {
      "socks5_proxy": "socks5://127.0.0.1:1080",
      "socks5_username": "user",
      "socks5_password": "pass"
    }
  }
}
```

#### å‘½ä»¤è¡Œå‚æ•°

```bash
# ä½¿ç”¨SOCKS5ä¸Šæ¸¸ä»£ç†
go run main.go -socks5-proxy socks5://127.0.0.1:1080 -socks5-username user -socks5-password pass
```

### SOCKS5 ä»£ç†æˆåŠŸæ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**: èƒ½å¤Ÿé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šSOCKS5ä¸Šæ¸¸ä»£ç†
2. **é…ç½®çµæ´»æ€§**: èƒ½å¤Ÿé€šè¿‡é…ç½®æ–‡ä»¶é…ç½®SOCKS5ä¸Šæ¸¸ä»£ç†
3. **ä»£ç†è½¬å‘èƒ½åŠ›**: SOCKS5ä»£ç†èƒ½å¤Ÿæ­£å¸¸è½¬å‘HTTP/HTTPSè¯·æ±‚
4. **å…¼å®¹æ€§ä¿è¯**: ä¸ç°æœ‰HTTPå’ŒWebSocketä»£ç†åŠŸèƒ½å®Œå…¨å…¼å®¹
5. **è®¤è¯æ”¯æŒ**: æ”¯æŒSOCKS5ä»£ç†çš„ç”¨æˆ·åå¯†ç è®¤è¯
6. **é…ç½®è¦†ç›–**: æ”¯æŒé€šè¿‡é…ç½®å­—æ®µè¦†ç›–ä»£ç†URLä¸­çš„ç”¨æˆ·åå¯†ç 
7. **ç¨³å®šæ€§**: SOCKS5è¿æ¥ç¨³å®šï¼Œé”™è¯¯å¤„ç†å®Œå–„

### é¡¹ç›®æ•´ä½“çŠ¶æ€

#### å·²å®Œæˆçš„ä»£ç†æ”¯æŒ

1. **HTTP/HTTPSä»£ç†** âœ… - åŸºç¡€ä»£ç†åŠŸèƒ½
2. **WebSocketä»£ç†** âœ… - é€šè¿‡9ä¸ªä¸»è¦ä»»åŠ¡å®Œæˆ
3. **SOCKS5ä»£ç†** âœ… - é€šè¿‡7ä¸ªéªŒè¯ä»»åŠ¡ç¡®è®¤å®Œæˆ

#### æŠ€æœ¯ç‰¹ç‚¹

- **å¤šåè®®æ”¯æŒ**: åŒæ—¶æ”¯æŒHTTPã€WebSocketå’ŒSOCKS5ä¸‰ç§ä»£ç†åè®®
- **çµæ´»é…ç½®**: æ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶ä¸¤ç§é…ç½®æ–¹å¼
- **ç”¨æˆ·åå¯†ç è¦†ç›–**: æ‰€æœ‰ä»£ç†ç±»å‹éƒ½æ”¯æŒé€šè¿‡é…ç½®å­—æ®µè¦†ç›–URLä¸­çš„è®¤è¯ä¿¡æ¯
- **å‘åå…¼å®¹**: æ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰é…ç½®å’Œä½¿ç”¨æ–¹å¼
- **ç»Ÿä¸€æ¥å£**: é€šè¿‡ç»Ÿä¸€çš„ä»£ç†é€‰æ‹©é€»è¾‘å¤„ç†ä¸åŒç±»å‹çš„ä»£ç†

#### ä¸‹ä¸€æ­¥å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**: è€ƒè™‘å®ç°è¿æ¥æ± å’Œè¿æ¥å¤ç”¨
2. **ç›‘æ§å¢å¼º**: æ·»åŠ æ›´è¯¦ç»†çš„ä»£ç†è¿æ¥çŠ¶æ€ç›‘æ§
3. **æµ‹è¯•å®Œå–„**: å¢åŠ æ›´å¤šè¾¹ç•Œæƒ…å†µçš„æµ‹è¯•ç”¨ä¾‹
4. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°README.mdï¼Œæ·»åŠ æ‰€æœ‰ä»£ç†ç±»å‹çš„è¯¦ç»†ä½¿ç”¨è¯´æ˜if proxyURL != nil && (strings.HasPrefix(proxyURL.String(), "ws://") || strings.HasPrefix(proxyURL.String(), "wss://")) {
    // è§£æç›®æ ‡åœ°å€
    host, port, err := net.SplitHostPort(upstreamAddress)
    if err != nil {
        // å¦‚æœæ²¡æœ‰ç«¯å£ï¼Œå°è¯•æ·»åŠ é»˜è®¤ç«¯å£
        if strings.Contains(upstreamAddress, ":") {
            // IPv6åœ°å€
            upstreamAddress = "[" + upstreamAddress + "]:80"
        } else {
            // åŸŸåæˆ–IPv4åœ°å€
            upstreamAddress = upstreamAddress + ":80"
        }
        host, port, err = net.SplitHostPort(upstreamAddress)
        if err != nil {
            log.Println("failed to parse address:", err)
            fmt.Fprint(client, "HTTP/1.1 502 Bad Gateway\r\n\r\n")
            return
        }
    }

    // è½¬æ¢ç«¯å£å·ä¸ºæ•´æ•°
    portNum, err := strconv.Atoi(port)
    if err != nil {
        log.Println("failed to parse port:", err)
        fmt.Fprint(client, "HTTP/1.1 502 Bad Gateway\r\n\r\n")
        return
    }

    // åˆ›å»ºWebSocketå®¢æˆ·ç«¯é…ç½®
    wsConfig := interfaces.ClientConfig{
        Username:   proxyURL.User.Username(),
        Password:   "",
        ServerAddr: proxyURL.String(),
        Protocol:   "websocket",
        Timeout:    30 * time.Second,
    }
    if proxyURL.User != nil {
        if password, ok := proxyURL.User.Password(); ok {
            wsConfig.Password = password
        }
    }

    // åˆ›å»ºWebSocketå®¢æˆ·ç«¯
    websocketClient := socks5_websocket_proxy_golang_websocket.NewWebSocketClient(wsConfig)

    // è¿æ¥åˆ°ç›®æ ‡ä¸»æœº
    err = websocketClient.Connect(host, portNum)
    if err != nil {
        log.Println("failed to connect via WebSocket proxy:", err)
        fmt.Fprint(client, "HTTP/1.1 502 Bad Gateway\r\n\r\n")
        return
    }

    // åˆ›å»ºä¸€ä¸ªç®¡é“è¿æ¥æ¥å¤„ç†WebSocketæ•°æ®è½¬å‘
    clientConn, serverConn := net.Pipe()

    // åœ¨goroutineä¸­å¤„ç†WebSocketæ•°æ®è½¬å‘
    go func() {
        defer clientConn.Close()
        defer serverConn.Close()
        // ä½¿ç”¨ForwardDataæ–¹æ³•å¤„ç†WebSocketè¿æ¥
        err := websocketClient.ForwardData(serverConn)
        if err != nil {
            fmt.Printf("WebSocket ForwardData error: %v\n", err)
        }
    }()

    server = clientConn
    log.Println("WebSocketä»£ç†è¿æ¥æˆåŠŸï¼š" + upstreamAddress)
}
```

## æ·»åŠ  SOCKS5 åè®®æ”¯æŒ

### ä»»åŠ¡ç›®æ ‡

ä¸ºé¡¹ç›®æ·»åŠ  SOCKS5 åè®®ä½œä¸ºä¸Šæ¸¸ä»£ç†çš„æ”¯æŒï¼Œä½¿ç”¨
github.com/masx200/socks5-websocket-proxy-golang/pkg/socks5 å®ç°ã€‚

### è¯¦ç»†ä»»åŠ¡æ¸…å•

#### 9. è®¾è®¡ SOCKS5 ä»£ç†æ”¯æŒæ¶æ„ âœ…

- [x] åˆ†æç°æœ‰çš„ WebSocket ä»£ç†å®ç°ï¼Œå¤ç”¨æ¶æ„è®¾è®¡
- [x] å®šä¹‰ SOCKS5 ä¸Šæ¸¸ä»£ç†çš„é…ç½®ç»“æ„
- [x] è®¾è®¡ SOCKS5 ä»£ç†å®¢æˆ·ç«¯æ¥å£é›†æˆæ–¹æ¡ˆ
- [x] è§„åˆ’ä¸ç°æœ‰ä»£ç†ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ

**è®¾è®¡æ–¹æ¡ˆè¯´æ˜ï¼š**

##### 1. UpStreamç»“æ„ä½“æ‰©å±•è®¾è®¡

```go
type UpStream struct {

    TYPE        string   `json:"type"`
    HTTP_PROXY   string   `json:"http_proxy"`
    HTTPS_PROXY  string   `json:"https_proxy"`
    BypassList   []string `json:"bypass_list"`
    // WebSocketæ”¯æŒ
    WS_PROXY     string   `json:"ws_proxy"`      // WebSocketä»£ç†åœ°å€
    WS_USERNAME  string   `json:"ws_username"`   // WebSocketä»£ç†ç”¨æˆ·å
    WS_PASSWORD  string   `json:"ws_password"`   // WebSocketä»£ç†å¯†ç 
    // æ–°å¢SOCKS5æ”¯æŒ
    SOCKS5_PROXY    string   `json:"socks5_proxy"`      // SOCKS5ä»£ç†åœ°å€
    SOCKS5_USERNAME string   `json:"socks5_username"`   // SOCKS5ä»£ç†ç”¨æˆ·å
    SOCKS5_PASSWORD string   `json:"socks5_password"`   // SOCKS5ä»£ç†å¯†ç 
}
```

##### 2. å‘½ä»¤è¡Œå‚æ•°æ ¼å¼è®¾è®¡

```bash
-upstream-type socks5       # æŒ‡å®šä¸Šæ¸¸ä»£ç†ç±»å‹ä¸ºsocks5
-upstream-address socks5://127.0.0.1:1080  # SOCKS5ä»£ç†åœ°å€
-upstream-username user    # SOCKS5ä»£ç†ç”¨æˆ·å
-upstream-password pass    # SOCKS5ä»£ç†å¯†ç 
```

##### 3. é…ç½®æ–‡ä»¶æ‰©å±•æ ¼å¼è®¾è®¡

```json
{
  "upstreams": {
    "socks5_proxy": {
      "type": "socks5",
      "http_proxy": "",
      "https_proxy": "",
      "bypass_list": [],
      "socks5_proxy": "socks5://127.0.0.1:1080",
      "socks5_username": "user",
      "socks5_password": "pass"
    }
  },
  "rules": [
    {
      "filter": "socks5_filter",
      "upstream": "socks5_proxy"
    }
  ],
  "filters": {
    "socks5_filter": {
      "patterns": ["*"]
    }
  }
}
```

#### 10. æ‰©å±•é…ç½®ç»“æ„æ”¯æŒ SOCKS5 âœ…

- [x] æ‰©å±• UpStream ç»“æ„ä½“ï¼Œæ·»åŠ  SOCKS5 ç›¸å…³å­—æ®µ
- [x] æ›´æ–° Config ç»“æ„ä½“ä»¥æ”¯æŒæ–°é…ç½®
- [x] ä¿®æ”¹é…ç½®æ–‡ä»¶è§£æé€»è¾‘
- [x] æ·»åŠ  SOCKS5 ä»£ç†é…ç½®éªŒè¯

#### 11. æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ SOCKS5 ğŸ”„

- [x] æ‰©å±•-upstream-type å‚æ•°æ”¯æŒ socks5 å€¼
- [x] ä¿®æ”¹-upstream-address å‚æ•°å¤„ç†é€»è¾‘æ”¯æŒ socks5:// åè®®
- [x] æ›´æ–° main å‡½æ•°ä¸­çš„å‚æ•°è§£æé€»è¾‘
- [x] æ·»åŠ  SOCKS5 ä»£ç†é…ç½®çš„è‡ªåŠ¨åˆ›å»ºé€»è¾‘

#### 12. é›†æˆ SOCKS5 å®¢æˆ·ç«¯ ğŸ”„

- [x] æ·»åŠ  socks5-websocket-proxy-golang/pkg/socks5 ä¾èµ–å¯¼å…¥
- [x] å®ç° SOCKS5 ä»£ç†å®¢æˆ·ç«¯åŒ…è£…å™¨
- [x] åˆ›å»ºä¸æ ‡å‡†åº“å…¼å®¹çš„ä»£ç†å‡½æ•°
- [x] å®ç° SOCKS5 è¿æ¥ç®¡ç†
- [x] é›†æˆåˆ°ç°æœ‰çš„ä»£ç†é€‰æ‹©é€»è¾‘ä¸­

**å®ç°æ–¹æ¡ˆï¼š**

```go
// æ·»åŠ ä¾èµ–
import (
    "github.com/masx200/socks5-websocket-proxy-golang/pkg/interfaces"
    "github.com/masx200/socks5-websocket-proxy-golang/pkg/socks5"
)

// SOCKS5ä»£ç†å®¢æˆ·ç«¯é…ç½®
var socks5Config interfaces.ClientConfig = interfaces.ClientConfig{
    Username:   socks5Username,
    Password:   socks5Password,
    ServerAddr: socks5Address,
    Protocol:   "socks5",
    Timeout:    30 * time.Second,
}

// åˆ›å»ºSOCKS5å®¢æˆ·ç«¯
socks5Client := socks5.NewSOCKS5Client(socks5Config)
```

#### 13. ä¿®æ”¹ä»£ç†é€‰æ‹©é€»è¾‘æ”¯æŒ SOCKS5 âœ…

- [x] æ›´æ–° ProxySelector å‡½æ•°ä»¥æ”¯æŒ SOCKS5 ç±»å‹
- [x] ä¿®æ”¹ SelectProxyURLWithCIDR å‡½æ•°æ”¯æŒ socks5:// åè®®
- [x] å®ç° SOCKS5 ä»£ç†çš„ç‰¹æ®Šå¤„ç†é€»è¾‘
- [x] æ·»åŠ  socks5:// åè®®å‰ç¼€çš„åˆ¤æ–­é€»è¾‘
- [x] åœ¨ transportConfigurations ä¸­é›†æˆ SOCKS5 ä»£ç†

#### 14. åœ¨simple.Handleå’Œauth.Handleå‡½æ•°ä¸­å®ç°SOCKS5ä»£ç†æ”¯æŒ ğŸ”„

- [x] ä¿®æ”¹simple.Handleå‡½æ•°æ”¯æŒSOCKS5ä»£ç†è¿æ¥
- [x] ä¿®æ”¹auth.Handleå‡½æ•°æ”¯æŒSOCKS5ä»£ç†è¿æ¥
- [x] æ·»åŠ SOCKS5ä»£ç†ç›¸å…³çš„å¯¼å…¥åŒ…
- [x] å®ç°HTTPæ•°æ®åŒ…è§£æè·å–ç›®æ ‡æœåŠ¡å™¨åŸŸåå’Œç«¯å£
- [x] è°ƒç”¨socks5.NewSOCKS5Client(socks5Config)
- [x] å°†è§£æçš„å‚æ•°ä¼ é€’ç»™ç›¸åº”çš„ä»£ç†å‡½æ•°
- [x] å®ç°SOCKS5è¿æ¥çš„æ•°æ®è½¬å‘é€»è¾‘

#### 15. å®ç°ç”¨æˆ·åå¯†ç è¦†ç›–åŠŸèƒ½æ”¯æŒ SOCKS5 ğŸ”„

- [x] æ‰©å±•overrideProxyURLCredentialså‡½æ•°æ”¯æŒSOCKS5ä»£ç†
- [x] æ”¯æŒsocks5_usernameå’Œsocks5_passwordè¦†ç›–socks5_proxyçš„URLä¸­çš„ç”¨æˆ·åå¯†ç 
- [x] ç¡®ä¿SOCKS5ä»£ç†URLè¿”å›é€»è¾‘éƒ½ä½¿ç”¨ç”¨æˆ·åå¯†ç è¦†ç›–åŠŸèƒ½
- [x] æ·»åŠ SOCKS5ä»£ç†URLçš„è§£æå’ŒéªŒè¯é€»è¾‘

#### 16. æ›´æ–°é…ç½®æ–‡ä»¶ç¤ºä¾‹å’Œæ–‡æ¡£ ğŸ”„

- [x] ä¿®æ”¹ config.json æ·»åŠ  SOCKS5 ä¸Šæ¸¸ç¤ºä¾‹
- [x] æ›´æ–° README.md æ–‡æ¡£è¯´æ˜æ–°åŠŸèƒ½
- [x] æ·»åŠ SOCKS5ä»£ç†çš„ä½¿ç”¨ç¤ºä¾‹å’Œè¯´æ˜
- [x] æ›´æ–°å‘½ä»¤è¡Œå‚æ•°è¯´æ˜æ–‡æ¡£

### æŠ€æœ¯è¦ç‚¹

#### éœ€è¦ä¿®æ”¹çš„æ ¸å¿ƒæ–‡ä»¶

1. **main.go** - æ‰©å±•å‘½ä»¤è¡Œå‚æ•°å’Œä¸»è¦é€»è¾‘
2. **config.json** - æ›´æ–°é…ç½®ç¤ºä¾‹
3. **README.md** - æ›´æ–°æ–‡æ¡£
4. **simple/simple.go** - æ·»åŠ SOCKS5ä»£ç†æ”¯æŒ
5. **auth/auth.go** - æ·»åŠ SOCKS5ä»£ç†æ”¯æŒ

#### å…³é”®æŠ€æœ¯å®ç°

1. **SOCKS5å®¢æˆ·ç«¯é›†æˆ** - ä½¿ç”¨æä¾›çš„ socks5-websocket-proxy-golang/pkg/socks5 åº“
2. **ä»£ç†ç±»å‹è¯†åˆ«** - åœ¨ ProxySelector ä¸­æ·»åŠ  SOCKS5 ç±»å‹åˆ¤æ–­
3. **é…ç½®æ‰©å±•** - ä¿æŒå‘åå…¼å®¹çš„åŒæ—¶æ·»åŠ æ–°åŠŸèƒ½
4. **è¿æ¥ç®¡ç†** - ç¡®ä¿ SOCKS5 è¿æ¥çš„æ­£ç¡®å»ºç«‹å’Œå…³é—­
5. **æ•°æ®è½¬å‘** - å®ç°SOCKS5è¿æ¥çš„åŒå‘æ•°æ®è½¬å‘

#### é›†æˆæ–¹æ¡ˆ

```go
// æ£€æŸ¥æ˜¯å¦éœ€è¦ä½¿ç”¨SOCKS5ä»£ç†
if proxyURL != nil && (strings.HasPrefix(proxyURL.String(), "socks5://") || strings.HasPrefix(proxyURL.String(), "socks5h://")) {
    // è§£æç›®æ ‡åœ°å€
    host, port, err := net.SplitHostPort(upstreamAddress)
    if err != nil {
        // å¤„ç†åœ°å€è§£æé”™è¯¯
    }

    // è½¬æ¢ç«¯å£å·ä¸ºæ•´æ•°
    portNum, err := strconv.Atoi(port)
    if err != nil {
        // å¤„ç†ç«¯å£è§£æé”™è¯¯
    }

    // åˆ›å»ºSOCKS5å®¢æˆ·ç«¯é…ç½®
    socks5Config := interfaces.ClientConfig{
        Username:   proxyURL.User.Username(),
        Password:   "",
        ServerAddr: proxyURL.String(),
        Protocol:   "socks5",
        Timeout:    30 * time.Second,
    }
    if proxyURL.User != nil {
        if password, ok := proxyURL.User.Password(); ok {
            socks5Config.Password = password
        }
    }

    // åˆ›å»ºSOCKS5å®¢æˆ·ç«¯
    socks5Client := socks5.NewSOCKS5Client(socks5Config)

    // è¿æ¥åˆ°ç›®æ ‡ä¸»æœº
    err = socks5Client.Connect(host, portNum)
    if err != nil {
        // å¤„ç†è¿æ¥é”™è¯¯
    }

    // åˆ›å»ºç®¡é“è¿æ¥å¤„ç†æ•°æ®è½¬å‘
    clientConn, serverConn := net.Pipe()

    // åœ¨goroutineä¸­å¤„ç†SOCKS5æ•°æ®è½¬å‘
    go func() {
        defer clientConn.Close()
        defer serverConn.Close()
        err := socks5Client.ForwardData(serverConn)
        if err != nil {
            fmt.Printf("SOCKS5 ForwardData error: %v\n", err)
        }
    }()

    server = clientConn
    log.Println("SOCKS5ä»£ç†è¿æ¥æˆåŠŸï¼š" + upstreamAddress)
}
```

### å®æ–½ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼šè®¾è®¡ SOCKS5 æ”¯æŒã€æ‰©å±•é…ç½®ç»“æ„ã€é›†æˆ SOCKS5 å®¢æˆ·ç«¯
2. **ä¸­ä¼˜å…ˆçº§**ï¼šæ·»åŠ å‘½ä»¤è¡Œå‚æ•°ã€ä¿®æ”¹ä»£ç†é€‰æ‹©é€»è¾‘ã€å®ç°å¤„ç†å‡½æ•°æ”¯æŒ
3. **ä½ä¼˜å…ˆçº§**ï¼šæ›´æ–°æ–‡æ¡£ã€æµ‹è¯•éªŒè¯

### é£é™©è¯„ä¼°

#### æŠ€æœ¯é£é™©

- **SOCKS5åè®®å¤æ‚æ€§**: SOCKS5åè®®éœ€è¦å¤„ç†è®¤è¯ã€åœ°å€ç±»å‹ç­‰å¤šç§æƒ…å†µ
- **è¿æ¥ç®¡ç†**: éœ€è¦æ­£ç¡®å¤„ç†SOCKS5è¿æ¥çš„å»ºç«‹ã€è®¤è¯å’Œæ•°æ®è½¬å‘
- **é”™è¯¯å¤„ç†**: SOCKS5åè®®æœ‰ç‰¹å®šçš„é”™è¯¯ç å’Œå¤„ç†æ–¹å¼
- **æ€§èƒ½å½±å“**: SOCKS5è¿æ¥å»ºç«‹éœ€è¦é¢å¤–çš„æ¡æ‰‹è¿‡ç¨‹

#### å…¼å®¹æ€§é£é™©

- **é…ç½®æ–‡ä»¶å…¼å®¹æ€§**: æ–°å¢SOCKS5ç›¸å…³å­—æ®µéœ€è¦ä¿æŒå‘åå…¼å®¹
- **ä»£ç†åˆ‡æ¢é€»è¾‘**: éœ€è¦ç¡®ä¿SOCKS5ä»£ç†å’Œå…¶ä»–ä»£ç†ç±»å‹èƒ½å¤Ÿæ­£ç¡®åˆ‡æ¢
- **URLæ ¼å¼**: éœ€è¦æ­£ç¡®å¤„ç†socks5://å’Œsocks5h://ä¸¤ç§URLæ ¼å¼

### æˆåŠŸæ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**: èƒ½å¤Ÿé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®š SOCKS5 ä¸Šæ¸¸ä»£ç†
2. **é…ç½®çµæ´»æ€§**: èƒ½å¤Ÿé€šè¿‡é…ç½®æ–‡ä»¶é…ç½® SOCKS5 ä¸Šæ¸¸ä»£ç†
3. **ä»£ç†è½¬å‘èƒ½åŠ›**: SOCKS5 ä»£ç†èƒ½å¤Ÿæ­£å¸¸è½¬å‘ HTTP/HTTPS è¯·æ±‚
4. **å…¼å®¹æ€§ä¿è¯**: ä¿æŒç°æœ‰åŠŸèƒ½çš„å®Œæ•´æ€§å’Œå‘åå…¼å®¹æ€§
5. **è®¤è¯æ”¯æŒ**: æ”¯æŒ SOCKS5 ç”¨æˆ·åå¯†ç è®¤è¯
6. **ç¨³å®šæ€§**: SOCKS5 è¿æ¥ç¨³å®šï¼Œé”™è¯¯å¤„ç†å®Œå–„
7. **æ€§èƒ½**: è¿æ¥å»ºç«‹å’Œè½¬å‘æ€§èƒ½æ»¡è¶³åŸºæœ¬ä½¿ç”¨éœ€æ±‚
