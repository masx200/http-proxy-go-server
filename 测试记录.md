###

# HTTP代理服务器测试记录

## 测试时间

2025-09-11 22:15:03

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器... ✅ 代理服务器编译成功

📋 代理服务器进程PID: 42528

等待服务器启动... ✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 45936

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10840541557469770716
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10840541557469770716
```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 43260

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 28992

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11386866654509221797
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11386866654509221797
```

### 📋 所有进程PID记录

所有进程PID: 42528, 45936, 43260, 28992

###

# HTTP代理服务器测试记录

## 测试时间

2025-09-11 22:15:03

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器... ✅ 代理服务器编译成功

📋 代理服务器进程PID: 42528

等待服务器启动... ✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 45936

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10840541557469770716
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10840541557469770716
```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 43260

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 28992

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11386866654509221797
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11386866654509221797
```

### 📋 所有进程PID记录

所有进程PID: 42528, 45936, 43260, 28992

## 3. 关闭代理服务器

✅ 所有curl测试成功，正在关闭代理服务器进程...

🛑 正在终止代理服务器进程... ✅ 代理服务器进程已终止

🧹 正在清理所有子进程...

✅ 所有子进程已清理完成

🧹 已清理编译的可执行文件

### 代理服务器日志输出

```
2025/09/11 22:15:04 main.go:518: 代理服务器启动中...
dohalpn: []
hostname: 0.0.0.0
port: 8080
server_cert: 
server_key: 
username: 
password: 
dohurl: []
dohip: []
upstream-type: 
upstream-address: 
upstream-username: 
upstream-password: 
null
2025/09/11 22:15:04 simple.go:31: Proxy server started on port [::]:8080
Random IP: 127.215.172.35
Random integer: 19799
2025/09/11 22:15:04 http.go:341: Proxy server started on port 127.215.172.35:19799
2025/09/11 22:15:05 simple.go:57: remote addr: [::1]:39059
GET http://www.baidu.com/ HTTP/1.1
Domain: www.baidu.com, Port: 80
address:www.baidu.com:80
开始检查CheckShouldUseProxy 127.215.172.35:19799
2025/09/11 22:15:05 simple.go:227: 连接成功：127.215.172.35:19799
2025/09/11 22:15:05 simple.go:241: clienthost: ::1
2025/09/11 22:15:05 simple.go:242: clientport: 39059
2025/09/11 22:15:05 simple.go:271: simple Handle header:
2025/09/11 22:15:05 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
GET / HTTP/1.1
Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
method: GET
url: /
host: www.baidu.com
2025/09/11 22:15:05 http.go:92: proxyHandler header:
2025/09/11 22:15:05 http.go:119: clienthost: 127.0.0.1
2025/09/11 22:15:05 http.go:120: clientport: 39060
2025/09/11 22:15:05 http.go:131: proxyHandler User-Agent : Go-http-client/1.1
2025/09/11 22:15:05 http.go:131: proxyHandler Accept-Encoding : gzip
2025/09/11 22:15:05 http.go:131: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.215.172.35:19799;host=www.baidu.com;proto=http
2025/09/11 22:15:05 http.go:134: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.215.172.35:19799;host=www.baidu.com;proto=http
2025/09/11 22:15:05 http.go:136: forwardedByList: [{[::1]:8080} {127.215.172.35:19799}]
targetUrl: http://www.baidu.com/
开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:15:05 | 200 |     57.0819ms |       127.0.0.1 | GET      "/"
2025/09/11 22:15:07 simple.go:57: remote addr: [::1]:39129
HEAD http://www.baidu.com/ HTTP/1.1
Domain: www.baidu.com, Port: 80
address:www.baidu.com:80
开始检查CheckShouldUseProxy 127.215.172.35:19799
2025/09/11 22:15:07 simple.go:227: 连接成功：127.215.172.35:19799
2025/09/11 22:15:07 simple.go:241: clienthost: ::1
2025/09/11 22:15:07 simple.go:242: clientport: 39129
2025/09/11 22:15:07 simple.go:271: simple Handle header:
2025/09/11 22:15:07 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
HEAD / HTTP/1.1
Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
method: HEAD
url: /
host: www.baidu.com
2025/09/11 22:15:07 http.go:92: proxyHandler header:
2025/09/11 22:15:07 http.go:119: clienthost: 127.0.0.1
2025/09/11 22:15:07 http.go:120: clientport: 39130
2025/09/11 22:15:07 http.go:131: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.215.172.35:19799;host=www.baidu.com;proto=http
2025/09/11 22:15:07 http.go:131: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:15:07 http.go:131: proxyHandler Accept : */*
2025/09/11 22:15:07 http.go:131: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:15:07 http.go:134: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.215.172.35:19799;host=www.baidu.com;proto=http
2025/09/11 22:15:07 http.go:136: forwardedByList: [{[::1]:8080} {127.215.172.35:19799}]
targetUrl: http://www.baidu.com/
开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:15:07 | 200 |     12.2887ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:15:07 simple.go:57: remote addr: [::1]:39131
HEAD http://www.so.com/ HTTP/1.1
Domain: www.so.com, Port: 80
address:www.so.com:80
开始检查CheckShouldUseProxy 127.215.172.35:19799
2025/09/11 22:15:07 simple.go:227: 连接成功：127.215.172.35:19799
2025/09/11 22:15:07 simple.go:241: clienthost: ::1
2025/09/11 22:15:07 simple.go:242: clientport: 39131
2025/09/11 22:15:07 simple.go:271: simple Handle header:
2025/09/11 22:15:07 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
HEAD / HTTP/1.1
Forwarded: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
Host: www.so.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
method: HEAD
url: /
host: www.so.com
2025/09/11 22:15:07 http.go:92: proxyHandler header:
2025/09/11 22:15:07 http.go:119: clienthost: 127.0.0.1
2025/09/11 22:15:07 http.go:120: clientport: 39132
2025/09/11 22:15:07 http.go:131: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http,for=127.0.0.1;by=127.215.172.35:19799;host=www.so.com;proto=http
2025/09/11 22:15:07 http.go:131: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:15:07 http.go:131: proxyHandler Accept : */*
2025/09/11 22:15:07 http.go:131: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:15:07 http.go:134: forwardedHeader: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http, for=127.0.0.1;by=127.215.172.35:19799;host=www.so.com;proto=http
2025/09/11 22:15:07 http.go:136: forwardedByList: [{[::1]:8080} {127.215.172.35:19799}]
targetUrl: http://www.so.com/
开始检查CheckShouldUseProxy www.so.com
[GIN] 2025/09/11 - 22:15:07 | 302 |     25.0749ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:15:07 simple.go:57: remote addr: [::1]:39140
CONNECT www.baidu.com:443 HTTP/1.1
address:www.baidu.com:443
开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/11 22:15:07 options.go:98: hostname www.baidu.com no ip found
2025/09/11 22:15:07 options.go:123: success connect to www.baidu.com:443 by tcp
2025/09/11 22:15:07 simple.go:227: 连接成功：www.baidu.com:443
```

### 所有子进程日志输出

```
### Curl测试1输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10840541557469770716
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10840541557469770716
### Curl测试2输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
### Curl测试3输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:14:55 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11386866654509221797
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:14:55 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11386866654509221797
```

✅ 端口8080已成功释放

###

# HTTP代理服务器测试记录

## 测试时间

2025-09-11 22:17:00

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器... ✅ 代理服务器编译成功

📋 代理服务器进程PID: 49604

等待服务器启动... ✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 2056

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10859478922751438141
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10859478922751438141
```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 16144

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 46504

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10669058013028899093
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10669058013028899093
```

### 📋 所有进程PID记录

所有进程PID: 49604, 2056, 16144, 46504

###

# HTTP代理服务器测试记录

## 测试时间

2025-09-11 22:17:00

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器... ✅ 代理服务器编译成功

📋 代理服务器进程PID: 49604

等待服务器启动... ✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 2056

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10859478922751438141
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10859478922751438141
```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 16144

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 46504

✅ 测试成功

输出结果:

```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10669058013028899093
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10669058013028899093
```

### 📋 所有进程PID记录

所有进程PID: 49604, 2056, 16144, 46504

## 3. 关闭代理服务器

✅ 所有curl测试成功，正在关闭代理服务器进程...

🛑 正在终止代理服务器进程... ✅ 代理服务器进程已终止

🧹 正在清理所有子进程...

✅ 所有子进程已清理完成

🧹 已清理编译的可执行文件

### 代理服务器日志输出

```
2025/09/11 22:17:01 main.go:518: 代理服务器启动中...
dohalpn: []
hostname: 0.0.0.0
port: 8080
server_cert: 
server_key: 
username: 
password: 
dohurl: []
dohip: []
upstream-type: 
upstream-address: 
upstream-username: 
upstream-password: 
null
2025/09/11 22:17:01 simple.go:31: Proxy server started on port [::]:8080
Random IP: 127.0.244.254
Random integer: 28336
2025/09/11 22:17:01 http.go:341: Proxy server started on port 127.0.244.254:28336
2025/09/11 22:17:02 simple.go:57: remote addr: [::1]:40046
GET http://www.baidu.com/ HTTP/1.1
Domain: www.baidu.com, Port: 80
address:www.baidu.com:80
开始检查CheckShouldUseProxy 127.0.244.254:28336
2025/09/11 22:17:02 simple.go:227: 连接成功：127.0.244.254:28336
2025/09/11 22:17:02 simple.go:241: clienthost: ::1
2025/09/11 22:17:02 simple.go:242: clientport: 40046
2025/09/11 22:17:02 simple.go:271: simple Handle header:
2025/09/11 22:17:02 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
GET / HTTP/1.1
Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
method: GET
url: /
host: www.baidu.com
2025/09/11 22:17:02 http.go:92: proxyHandler header:
2025/09/11 22:17:02 http.go:119: clienthost: 127.0.0.1
2025/09/11 22:17:02 http.go:120: clientport: 40047
2025/09/11 22:17:02 http.go:131: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.0.244.254:28336;host=www.baidu.com;proto=http
2025/09/11 22:17:02 http.go:131: proxyHandler User-Agent : Go-http-client/1.1
2025/09/11 22:17:02 http.go:131: proxyHandler Accept-Encoding : gzip
2025/09/11 22:17:02 http.go:134: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.0.244.254:28336;host=www.baidu.com;proto=http
2025/09/11 22:17:02 http.go:136: forwardedByList: [{[::1]:8080} {127.0.244.254:28336}]
targetUrl: http://www.baidu.com/
开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:17:02 | 200 |    104.1415ms |       127.0.0.1 | GET      "/"
2025/09/11 22:17:04 simple.go:57: remote addr: [::1]:40078
HEAD http://www.baidu.com/ HTTP/1.1
Domain: www.baidu.com, Port: 80
address:www.baidu.com:80
开始检查CheckShouldUseProxy 127.0.244.254:28336
2025/09/11 22:17:04 simple.go:227: 连接成功：127.0.244.254:28336
2025/09/11 22:17:04 simple.go:241: clienthost: ::1
2025/09/11 22:17:04 simple.go:242: clientport: 40078
2025/09/11 22:17:04 simple.go:271: simple Handle header:
2025/09/11 22:17:04 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
HEAD / HTTP/1.1
Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
method: HEAD
url: /
host: www.baidu.com
2025/09/11 22:17:04 http.go:92: proxyHandler header:
2025/09/11 22:17:04 http.go:119: clienthost: 127.0.0.1
2025/09/11 22:17:04 http.go:120: clientport: 40079
2025/09/11 22:17:04 http.go:131: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.0.244.254:28336;host=www.baidu.com;proto=http
2025/09/11 22:17:04 http.go:131: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:17:04 http.go:131: proxyHandler Accept : */*
2025/09/11 22:17:04 http.go:131: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:17:04 http.go:134: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.0.244.254:28336;host=www.baidu.com;proto=http
2025/09/11 22:17:04 http.go:136: forwardedByList: [{[::1]:8080} {127.0.244.254:28336}]
targetUrl: http://www.baidu.com/
开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:17:04 | 200 |     17.0327ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:17:04 simple.go:57: remote addr: [::1]:40082
HEAD http://www.so.com/ HTTP/1.1
Domain: www.so.com, Port: 80
address:www.so.com:80
开始检查CheckShouldUseProxy 127.0.244.254:28336
2025/09/11 22:17:04 simple.go:227: 连接成功：127.0.244.254:28336
2025/09/11 22:17:04 simple.go:241: clienthost: ::1
2025/09/11 22:17:04 simple.go:242: clientport: 40082
2025/09/11 22:17:04 simple.go:271: simple Handle header:
2025/09/11 22:17:04 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
HEAD / HTTP/1.1
Forwarded: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
Host: www.so.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
method: HEAD
url: /
host: www.so.com
2025/09/11 22:17:04 http.go:92: proxyHandler header:
2025/09/11 22:17:04 http.go:119: clienthost: 127.0.0.1
2025/09/11 22:17:04 http.go:120: clientport: 40083
2025/09/11 22:17:04 http.go:131: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:17:04 http.go:131: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http,for=127.0.0.1;by=127.0.244.254:28336;host=www.so.com;proto=http
2025/09/11 22:17:04 http.go:131: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:17:04 http.go:131: proxyHandler Accept : */*
2025/09/11 22:17:04 http.go:134: forwardedHeader: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http, for=127.0.0.1;by=127.0.244.254:28336;host=www.so.com;proto=http
2025/09/11 22:17:04 http.go:136: forwardedByList: [{[::1]:8080} {127.0.244.254:28336}]
targetUrl: http://www.so.com/
开始检查CheckShouldUseProxy www.so.com
[GIN] 2025/09/11 - 22:17:04 | 302 |     28.9715ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:17:04 simple.go:57: remote addr: [::1]:40085
CONNECT www.baidu.com:443 HTTP/1.1
address:www.baidu.com:443
开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/11 22:17:04 options.go:98: hostname www.baidu.com no ip found
2025/09/11 22:17:04 options.go:123: success connect to www.baidu.com:443 by tcp
2025/09/11 22:17:04 simple.go:227: 连接成功：www.baidu.com:443
```

### 所有子进程日志输出

```
### Curl测试1输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10859478922751438141
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10859478922751438141
### Curl测试2输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
### Curl测试3输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:16:52 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10669058013028899093
< 

  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:16:52 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10669058013028899093
```

✅ 端口8080已成功释放


###

# HTTP代理服务器测试记录

## 测试时间
2025-09-11 22:34:37

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器...
✅ 代理服务器编译成功

📋 代理服务器进程PID: 27676

等待服务器启动...
✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 30896

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_9873191334340542033
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_9873191334340542033


```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 50972

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/


```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 32120

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10699116045253906659
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10699116045253906659


```

### 📋 所有进程PID记录

所有进程PID: 27676, 30896, 50972, 32120



###

# HTTP代理服务器测试记录

## 测试时间
2025-09-11 22:34:37

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器...
✅ 代理服务器编译成功

📋 代理服务器进程PID: 27676

等待服务器启动...
✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 30896

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_9873191334340542033
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_9873191334340542033


```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 50972

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/


```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 32120

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10699116045253906659
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10699116045253906659


```

### 📋 所有进程PID记录

所有进程PID: 27676, 30896, 50972, 32120

## 3. 关闭代理服务器

✅ 所有curl测试成功，正在关闭代理服务器进程...

🛑 正在终止代理服务器进程...
✅ 代理服务器进程已终止

🧹 正在清理所有子进程...

✅ 所有子进程已清理完成

🧹 已清理编译的可执行文件
### 代理服务器日志输出

```
2025/09/11 22:34:39 main.go:518: 代理服务器启动中...
2025/09/11 22:34:39 main.go:562: dohalpn: []
2025/09/11 22:34:39 main.go:564: hostname: 0.0.0.0
2025/09/11 22:34:39 main.go:566: port: 8080
2025/09/11 22:34:39 main.go:568: server_cert: 
2025/09/11 22:34:39 main.go:570: server_key: 
2025/09/11 22:34:39 main.go:572: username: 
2025/09/11 22:34:39 main.go:574: password: 
2025/09/11 22:34:39 main.go:576: dohurl: []
2025/09/11 22:34:39 main.go:578: dohip: []
2025/09/11 22:34:39 main.go:579: upstream-type: 
2025/09/11 22:34:39 main.go:580: upstream-address: 
2025/09/11 22:34:39 main.go:581: upstream-username: 
2025/09/11 22:34:39 main.go:582: upstream-password: 
2025/09/11 22:34:39 main.go:854: null
2025/09/11 22:34:39 simple.go:31: Proxy server started on port [::]:8080
2025/09/11 22:34:39 http.go:372: Random IP: 127.145.8.121
2025/09/11 22:34:39 http.go:390: Random integer: 51857
2025/09/11 22:34:39 http.go:342: Proxy server started on port 127.145.8.121:51857
2025/09/11 22:34:40 simple.go:57: remote addr: [::1]:12144
2025/09/11 22:34:40 simple.go:72: GET http://www.baidu.com/ HTTP/1.1
Domain: www.baidu.com, Port: 80
2025/09/11 22:34:40 simple.go:110: address:www.baidu.com:80
2025/09/11 22:34:40 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.145.8.121:51857
2025/09/11 22:34:40 simple.go:227: 连接成功：127.145.8.121:51857
2025/09/11 22:34:40 simple.go:241: clienthost: ::1
2025/09/11 22:34:40 simple.go:242: clientport: 12144
2025/09/11 22:34:40 simple.go:271: simple Handle header:
2025/09/11 22:34:40 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:34:40 simple.go:276: GET / HTTP/1.1
2025/09/11 22:34:40 simple.go:281: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:34:40 simple.go:287: Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
2025/09/11 22:34:40 http.go:90: method: GET
2025/09/11 22:34:40 http.go:91: url: /
2025/09/11 22:34:40 http.go:92: host: www.baidu.com
2025/09/11 22:34:40 http.go:93: proxyHandler header:
2025/09/11 22:34:40 http.go:120: clienthost: 127.0.0.1
2025/09/11 22:34:40 http.go:121: clientport: 12145
2025/09/11 22:34:40 http.go:132: proxyHandler Accept-Encoding : gzip
2025/09/11 22:34:40 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.145.8.121:51857;host=www.baidu.com;proto=http
2025/09/11 22:34:40 http.go:132: proxyHandler User-Agent : Go-http-client/1.1
2025/09/11 22:34:40 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.145.8.121:51857;host=www.baidu.com;proto=http
2025/09/11 22:34:40 http.go:137: forwardedByList: [{[::1]:8080} {127.145.8.121:51857}]
2025/09/11 22:34:40 http.go:155: targetUrl: http://www.baidu.com/
2025/09/11 22:34:40 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:34:40 | 200 |     72.4482ms |       127.0.0.1 | GET      "/"
2025/09/11 22:34:42 simple.go:57: remote addr: [::1]:12178
2025/09/11 22:34:42 simple.go:72: HEAD http://www.baidu.com/ HTTP/1.1
Domain: www.baidu.com, Port: 80
2025/09/11 22:34:42 simple.go:110: address:www.baidu.com:80
2025/09/11 22:34:42 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.145.8.121:51857
2025/09/11 22:34:42 simple.go:227: 连接成功：127.145.8.121:51857
2025/09/11 22:34:42 simple.go:241: clienthost: ::1
2025/09/11 22:34:42 simple.go:242: clientport: 12178
2025/09/11 22:34:42 simple.go:271: simple Handle header:
2025/09/11 22:34:42 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:34:42 simple.go:276: HEAD / HTTP/1.1
2025/09/11 22:34:42 simple.go:281: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:34:42 simple.go:287: Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/11 22:34:42 http.go:90: method: HEAD
2025/09/11 22:34:42 http.go:91: url: /
2025/09/11 22:34:42 http.go:92: host: www.baidu.com
2025/09/11 22:34:42 http.go:93: proxyHandler header:
2025/09/11 22:34:42 http.go:120: clienthost: 127.0.0.1
2025/09/11 22:34:42 http.go:121: clientport: 12179
2025/09/11 22:34:42 http.go:132: proxyHandler Accept : */*
2025/09/11 22:34:42 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:34:42 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.145.8.121:51857;host=www.baidu.com;proto=http
2025/09/11 22:34:42 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:34:42 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.145.8.121:51857;host=www.baidu.com;proto=http
2025/09/11 22:34:42 http.go:137: forwardedByList: [{[::1]:8080} {127.145.8.121:51857}]
2025/09/11 22:34:42 http.go:155: targetUrl: http://www.baidu.com/
2025/09/11 22:34:42 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:34:42 | 200 |     12.2414ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:34:42 simple.go:57: remote addr: [::1]:12181
2025/09/11 22:34:42 simple.go:72: HEAD http://www.so.com/ HTTP/1.1
Domain: www.so.com, Port: 80
2025/09/11 22:34:42 simple.go:110: address:www.so.com:80
2025/09/11 22:34:42 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.145.8.121:51857
2025/09/11 22:34:42 simple.go:227: 连接成功：127.145.8.121:51857
2025/09/11 22:34:42 simple.go:241: clienthost: ::1
2025/09/11 22:34:42 simple.go:242: clientport: 12181
2025/09/11 22:34:42 simple.go:271: simple Handle header:
2025/09/11 22:34:42 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/11 22:34:42 simple.go:276: HEAD / HTTP/1.1
2025/09/11 22:34:42 simple.go:281: Forwarded: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/11 22:34:42 simple.go:287: Host: www.so.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/11 22:34:42 http.go:90: method: HEAD
2025/09/11 22:34:42 http.go:91: url: /
2025/09/11 22:34:42 http.go:92: host: www.so.com
2025/09/11 22:34:42 http.go:93: proxyHandler header:
2025/09/11 22:34:42 http.go:120: clienthost: 127.0.0.1
2025/09/11 22:34:42 http.go:121: clientport: 12182
2025/09/11 22:34:42 http.go:132: proxyHandler Accept : */*
2025/09/11 22:34:42 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:34:42 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http,for=127.0.0.1;by=127.145.8.121:51857;host=www.so.com;proto=http
2025/09/11 22:34:42 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:34:42 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http, for=127.0.0.1;by=127.145.8.121:51857;host=www.so.com;proto=http
2025/09/11 22:34:42 http.go:137: forwardedByList: [{[::1]:8080} {127.145.8.121:51857}]
2025/09/11 22:34:42 http.go:155: targetUrl: http://www.so.com/
2025/09/11 22:34:42 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.so.com
[GIN] 2025/09/11 - 22:34:42 | 302 |     28.7081ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:34:42 simple.go:57: remote addr: [::1]:12184
2025/09/11 22:34:42 simple.go:72: CONNECT www.baidu.com:443 HTTP/1.1
2025/09/11 22:34:42 simple.go:110: address:www.baidu.com:443
2025/09/11 22:34:42 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/11 22:34:42 options.go:98: hostname www.baidu.com no ip found
2025/09/11 22:34:42 options.go:123: success connect to www.baidu.com:443 by tcp
2025/09/11 22:34:42 simple.go:227: 连接成功：www.baidu.com:443
```

### 所有子进程日志输出

```
### Curl测试1输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_9873191334340542033
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_9873191334340542033
### Curl测试2输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
### Curl测试3输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:34:30 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_10699116045253906659
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:34:30 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_10699116045253906659
```

✅ 端口8080已成功释放


###

# HTTP代理服务器测试记录

## 测试时间
2025-09-11 22:44:49

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器...
✅ 代理服务器编译成功

📋 代理服务器进程PID: 3596

等待服务器启动...
✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 42068

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11168153454557820668
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11168153454557820668


```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 50980

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/


```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 45804

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11409499371391058990
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11409499371391058990


```

### 📋 所有进程PID记录

所有进程PID: 3596, 42068, 50980, 45804



###

# HTTP代理服务器测试记录

## 测试时间
2025-09-11 22:44:49

## 1. 启动代理服务器

执行命令: `go run -v ./main.go`

编译代理服务器...
✅ 代理服务器编译成功

📋 代理服务器进程PID: 3596

等待服务器启动...
✅ 代理服务器启动成功

## 2. 测试HTTP代理功能

### 测试1: 基本HTTP代理

执行命令: `curl -v -I http://www.baidu.com -x http://localhost:8080`

📋 Curl测试1进程PID: 42068

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11168153454557820668
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11168153454557820668


```

### 测试2: HTTP代理www.so.com

执行命令: `curl -v -I http://www.so.com -x http://localhost:8080`

📋 Curl测试2进程PID: 50980

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/


```

### 测试3: HTTPS代理

执行命令: `curl -v -I https://www.baidu.com -x http://localhost:8080`

📋 Curl测试3进程PID: 45804

✅ 测试成功

输出结果:
```
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11409499371391058990
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11409499371391058990


```

### 📋 所有进程PID记录

所有进程PID: 3596, 42068, 50980, 45804

## 3. 关闭代理服务器

✅ 所有curl测试成功，正在关闭代理服务器进程...

🛑 正在终止代理服务器进程...
✅ 代理服务器进程已终止

🧹 正在清理所有子进程...

✅ 所有子进程已清理完成

🧹 已清理编译的可执行文件
### 代理服务器日志输出

```
2025/09/11 22:44:51 main.go:518: 代理服务器启动中...
2025/09/11 22:44:51 main.go:562: dohalpn: []
2025/09/11 22:44:51 main.go:564: hostname: 0.0.0.0
2025/09/11 22:44:51 main.go:566: port: 8080
2025/09/11 22:44:51 main.go:568: server_cert: 
2025/09/11 22:44:51 main.go:570: server_key: 
2025/09/11 22:44:51 main.go:572: username: 
2025/09/11 22:44:51 main.go:574: password: 
2025/09/11 22:44:51 main.go:576: dohurl: []
2025/09/11 22:44:51 main.go:578: dohip: []
2025/09/11 22:44:51 main.go:579: upstream-type: 
2025/09/11 22:44:51 main.go:580: upstream-address: 
2025/09/11 22:44:51 main.go:581: upstream-username: 
2025/09/11 22:44:51 main.go:582: upstream-password: 
2025/09/11 22:44:51 main.go:854: null
2025/09/11 22:44:51 simple.go:31: Proxy server started on port [::]:8080
2025/09/11 22:44:51 http.go:372: Random IP: 127.71.194.85
2025/09/11 22:44:51 http.go:390: Random integer: 25751
2025/09/11 22:44:51 http.go:342: Proxy server started on port 127.71.194.85:25751
2025/09/11 22:44:52 simple.go:57: remote addr: [::1]:18851
2025/09/11 22:44:52 simple.go:72: GET http://www.baidu.com/ HTTP/1.1
2025/09/11 22:44:52 simple.go:298: Domain: www.baidu.com, Port: 80
2025/09/11 22:44:52 simple.go:110: address:www.baidu.com:80
2025/09/11 22:44:52 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.71.194.85:25751
2025/09/11 22:44:52 simple.go:227: 连接成功：127.71.194.85:25751
2025/09/11 22:44:52 simple.go:241: clienthost: ::1
2025/09/11 22:44:52 simple.go:242: clientport: 18851
2025/09/11 22:44:52 simple.go:271: simple Handle header:
2025/09/11 22:44:52 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:44:52 simple.go:276: GET / HTTP/1.1
2025/09/11 22:44:52 simple.go:281: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:44:52 simple.go:287: Host: www.baidu.com
User-Agent: Go-http-client/1.1
Accept-Encoding: gzip
2025/09/11 22:44:52 http.go:90: method: GET
2025/09/11 22:44:52 http.go:91: url: /
2025/09/11 22:44:52 http.go:92: host: www.baidu.com
2025/09/11 22:44:52 http.go:93: proxyHandler header:
2025/09/11 22:44:52 http.go:120: clienthost: 127.0.0.1
2025/09/11 22:44:52 http.go:121: clientport: 18852
2025/09/11 22:44:52 http.go:132: proxyHandler User-Agent : Go-http-client/1.1
2025/09/11 22:44:52 http.go:132: proxyHandler Accept-Encoding : gzip
2025/09/11 22:44:52 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.71.194.85:25751;host=www.baidu.com;proto=http
2025/09/11 22:44:52 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.71.194.85:25751;host=www.baidu.com;proto=http
2025/09/11 22:44:52 http.go:137: forwardedByList: [{[::1]:8080} {127.71.194.85:25751}]
2025/09/11 22:44:52 http.go:155: targetUrl: http://www.baidu.com/
2025/09/11 22:44:52 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:44:52 | 200 |      73.702ms |       127.0.0.1 | GET      "/"
2025/09/11 22:44:54 simple.go:57: remote addr: [::1]:18890
2025/09/11 22:44:54 simple.go:72: HEAD http://www.baidu.com/ HTTP/1.1
2025/09/11 22:44:54 simple.go:298: Domain: www.baidu.com, Port: 80
2025/09/11 22:44:54 simple.go:110: address:www.baidu.com:80
2025/09/11 22:44:54 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.71.194.85:25751
2025/09/11 22:44:54 simple.go:227: 连接成功：127.71.194.85:25751
2025/09/11 22:44:54 simple.go:241: clienthost: ::1
2025/09/11 22:44:54 simple.go:242: clientport: 18890
2025/09/11 22:44:54 simple.go:271: simple Handle header:
2025/09/11 22:44:54 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:44:54 simple.go:276: HEAD / HTTP/1.1
2025/09/11 22:44:54 simple.go:281: Forwarded: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http
2025/09/11 22:44:54 simple.go:287: Host: www.baidu.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/11 22:44:54 http.go:90: method: HEAD
2025/09/11 22:44:54 http.go:91: url: /
2025/09/11 22:44:54 http.go:92: host: www.baidu.com
2025/09/11 22:44:54 http.go:93: proxyHandler header:
2025/09/11 22:44:54 http.go:120: clienthost: 127.0.0.1
2025/09/11 22:44:54 http.go:121: clientport: 18891
2025/09/11 22:44:54 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http,for=127.0.0.1;by=127.71.194.85:25751;host=www.baidu.com;proto=http
2025/09/11 22:44:54 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:44:54 http.go:132: proxyHandler Accept : */*
2025/09/11 22:44:54 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:44:54 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.baidu.com:80;proto=http, for=127.0.0.1;by=127.71.194.85:25751;host=www.baidu.com;proto=http
2025/09/11 22:44:54 http.go:137: forwardedByList: [{[::1]:8080} {127.71.194.85:25751}]
2025/09/11 22:44:54 http.go:155: targetUrl: http://www.baidu.com/
2025/09/11 22:44:54 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com
[GIN] 2025/09/11 - 22:44:54 | 200 |     14.8101ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:44:54 simple.go:57: remote addr: [::1]:18893
2025/09/11 22:44:54 simple.go:72: HEAD http://www.so.com/ HTTP/1.1
2025/09/11 22:44:54 simple.go:298: Domain: www.so.com, Port: 80
2025/09/11 22:44:54 simple.go:110: address:www.so.com:80
2025/09/11 22:44:54 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy 127.71.194.85:25751
2025/09/11 22:44:54 simple.go:227: 连接成功：127.71.194.85:25751
2025/09/11 22:44:54 simple.go:241: clienthost: ::1
2025/09/11 22:44:54 simple.go:242: clientport: 18893
2025/09/11 22:44:54 simple.go:271: simple Handle header:
2025/09/11 22:44:54 simple.go:274: simple Handle Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/11 22:44:54 simple.go:276: HEAD / HTTP/1.1
2025/09/11 22:44:54 simple.go:281: Forwarded: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http
2025/09/11 22:44:54 simple.go:287: Host: www.so.com
User-Agent: curl/8.12.1
Accept: */*
Proxy-Connection: Keep-Alive
2025/09/11 22:44:54 http.go:90: method: HEAD
2025/09/11 22:44:54 http.go:91: url: /
2025/09/11 22:44:54 http.go:92: host: www.so.com
2025/09/11 22:44:54 http.go:93: proxyHandler header:
2025/09/11 22:44:54 http.go:120: clienthost: 127.0.0.1
2025/09/11 22:44:54 http.go:121: clientport: 18894
2025/09/11 22:44:54 http.go:132: proxyHandler Forwarded : for=::1;by=[::1]:8080;host=www.so.com:80;proto=http,for=127.0.0.1;by=127.71.194.85:25751;host=www.so.com;proto=http
2025/09/11 22:44:54 http.go:132: proxyHandler User-Agent : curl/8.12.1
2025/09/11 22:44:54 http.go:132: proxyHandler Accept : */*
2025/09/11 22:44:54 http.go:132: proxyHandler Proxy-Connection : Keep-Alive
2025/09/11 22:44:54 http.go:135: forwardedHeader: for=::1;by=[::1]:8080;host=www.so.com:80;proto=http, for=127.0.0.1;by=127.71.194.85:25751;host=www.so.com;proto=http
2025/09/11 22:44:54 http.go:137: forwardedByList: [{[::1]:8080} {127.71.194.85:25751}]
2025/09/11 22:44:54 http.go:155: targetUrl: http://www.so.com/
2025/09/11 22:44:54 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.so.com
[GIN] 2025/09/11 - 22:44:54 | 302 |     31.1335ms |       127.0.0.1 | HEAD     "/"
2025/09/11 22:44:54 simple.go:57: remote addr: [::1]:18896
2025/09/11 22:44:54 simple.go:72: CONNECT www.baidu.com:443 HTTP/1.1
2025/09/11 22:44:54 simple.go:110: address:www.baidu.com:443
2025/09/11 22:44:54 CheckShouldUseProxy.go:10: 开始检查CheckShouldUseProxy www.baidu.com:443
2025/09/11 22:44:54 options.go:98: hostname www.baidu.com no ip found
2025/09/11 22:44:54 options.go:123: success connect to www.baidu.com:443 by tcp
2025/09/11 22:44:54 simple.go:227: 连接成功：www.baidu.com:443
```

### 所有子进程日志输出

```
### Curl测试1输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.baidu.com/ HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11168153454557820668
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11168153454557820668
### Curl测试2输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD http://www.so.com/ HTTP/1.1
> Host: www.so.com
> User-Agent: curl/8.12.1
> Accept: */*
> Proxy-Connection: Keep-Alive
> 
* Request completely sent off
< HTTP/1.1 302 Found
< Connection: keep-alive
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Location: https://www.so.com/
< Server: openresty
< Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
< 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 302 Found
Connection: keep-alive
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Location: https://www.so.com/
Server: openresty
Set-Cookie: QiHooGUID=; Max-Age=63072000; Domain=so.com; Path=/
### Curl测试3输出 ###
Note: Using embedded CA bundle, for proxies (233263 bytes)
* Host localhost:8080 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:8080...
* CONNECT tunnel: HTTP/1.1 negotiated
* allocate connect buffer
* Establish HTTP proxy tunnel to www.baidu.com:443
> CONNECT www.baidu.com:443 HTTP/1.1
> Host: www.baidu.com:443
> User-Agent: curl/8.12.1
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
< 
* CONNECT phase completed
* CONNECT tunnel established, response 200
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [308 bytes data]
*  CAfile: D:\迅雷下载\curl-8.12.1_4-win64-mingw\bin\curl-ca-bundle.crt
*  CApath: none
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [102 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4771 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 / [blank] / UNDEF
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  9 07:01:02 2025 GMT
*  expire date: Aug 10 07:01:01 2026 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
*   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
*   Certificate level 2: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to localhost (::1) port 8080
* using HTTP/1.x
> HEAD / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/8.12.1
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 277
< Content-Type: text/html
< Date: Thu, 11 Sep 2025 14:44:42 GMT
< Etag: "575e1f60-115"
< Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Tr_id: bfe_11409499371391058990
< 
  0   277    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection #0 to host localhost left intact
HTTP/1.1 200 Connection established
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Thu, 11 Sep 2025 14:44:42 GMT
Etag: "575e1f60-115"
Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Tr_id: bfe_11409499371391058990
```

✅ 端口8080已成功释放
